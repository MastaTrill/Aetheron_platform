// index.js - Extracted from index.html inline <script> // All logic is preserved. Attach this file in index.html after ethers.js and chart.js // Contract Addresses - UPDATED February 82026 const AETH_ADDRESS = "0xAb5ae0D8f569d7c2B27574319b864a5bA6F9671e"const STAKING_ADDRESS = "0x896D9d37A67B0bBf81dde0005975DA7850FFa638"const LIQUIDITY_PAIR = "0xd57c5E33ebDC1b565F99d06809debbf86142705D"const OWNER_ADDRESS = "0x127C3a5A0922A0A952aDE71412E2DC651Aa7AF82".toLowerCaseconst POLYGON_CHAIN_ID = '0x89'// 137 in hex const POLYGON_RPC_URLS = [ 'https//polygon-rpc.com/''https//rpc-mainnet.matic.network''https//matic-mainnet.chainstacklabs.com''https//rpc-mainnet.maticvigil.com' ]// ABIs const AETH_ABI = [ "function nameview returnsstring""function symbolview returnsstring""function balanceOfaddressview returnsuint256""function transferaddress touint256 amountreturnsbool""function approveaddress spenderuint256 amountreturnsbool""function decimalsview returnsuint8""function totalSupplyview returnsuint256""function ownerview returnsaddress""function tradingEnabledview returnsbool""event Transferaddress indexed fromaddress indexed touint256 value""event Approvaladdress indexed owneraddress indexed spenderuint256 value" ]const STAKING_ABI = [ "function stakeuint256 poolIduint256 amount""function unstakeuint256 stakeId""function claimRewardsuint256 stakeId""function calculateRewardaddress useruint256 stakeIdview returnsuint256""function poolsuint256view returnsuint256 lockDurationuint256 rewardRateuint256 totalStakedbool isActive""function getUserStakesCountaddress userview returnsuint256""function getUserStakeaddress useruint256 stakeIdview returnsuint256 amountuint256 startTimeuint256 lastClaimTimeuint256 poolIduint256 pendingRewarduint256 unlockTime""function totalStakedview returnsuint256""function rewardBalanceview returnsuint256""event Stakedaddress indexed useruint256 poolIduint256 amount""event Unstakedaddress indexed useruint256 stakeIduint256 amount""event RewardClaimedaddress indexed useruint256 stakeIduint256 reward" ]let providersigneraccountlet aethContractstakingContractlet readOnlyProvider// For reading data without wallet connection let transactions = []let priceWebSocket// WebSocket for real-time price updates let reconnectAttempts = 0const MAX_RECONNECT_ATTEMPTS = 5let detectionAttempts = 0const maxAttempts = 5// Initialize read-only provider for live data function initReadOnlyProvider// Try multiple RPC endpoints for reliability forconst rpcUrl of POLYGON_RPC_URLStryreadOnlyProvider = new ethers.providers.JsonRpcProviderrpcUrlconsole.log'‚úÖ Read-only provider initialized'rpcUrl// Initialize read-only contracts for displaying stats const readOnlyAethContract = new ethers.ContractAETH_ADDRESSAETH_ABIreadOnlyProviderconst readOnlyStakingContract = new ethers.ContractSTAKING_ADDRESSSTAKING_ABIreadOnlyProviderreturnaethContractreadOnlyAethContractstakingContractreadOnlyStakingContractrpcUrlcatcherrorconsole.warn`‚ö†Ô∏è Failed to connect to $rpcUrl`error.messagecontinueconsole.error'‚ùå All RPC endpoints failed'return null// Initialize window.addEventListener'load'async=>console.log'üöÄ Aetheron Dashboard Loading...'// Initialize theme first initTheme// Set default values immediately to avoid "Loading..." stuck state setDefaultValues// Hook up connect wallet button const connectBtn = document.getElementById'connectBtn'ifconnectBtnconnectBtn.addEventListener'click'connectWallet// Initialize read-only provider first for live data const readOnlyContracts = initReadOnlyProviderifreadOnlyContracts// Use read-only contracts initially for stats if!aethContractaethContract = readOnlyContracts.aethContractif!stakingContractstakingContract = readOnlyContracts.stakingContractconsole.log'‚úÖ Using RPC'readOnlyContracts.rpcUrlelseconsole.warn'‚ö†Ô∏è Running without blockchain connection - showing defaults only'// Start updating stats immediately with live blockchain data await updateStats// Initialize WebSocket for real-time updates initializeWebSocket// Fallback polling for blockchain data every 30 seconds setIntervalupdateStats30000// Then check for wallet detectWalletWithRetrywindow.addEventListener'ethereum#initialized'handleEthereumInitoncetruesetTimeout=>if!window.ethereumconsole.log'Final checkWallet still not detected'checkWalletStatus5000console.log'‚úÖ Dashboard initialized!'// Initialize mobile menu initMobileMenu// Initialize progressive features initProgressBar// Add animation classes document.querySelectorAll'.stat-card.feature-card.card'.forEacheli=>setTimeout=> el.classList.add'fade-in'i * 100// Set default values to avoid stuck "Loading..." states function setDefaultValuesconst defaults = [id'priceValue'value'$0.00000001'id'priceChange'value'+0.00%24h'id'marketCapValue'value'$10'id'marketCapChange'value'+0.00%24h'id'stakedValue'value'0 AETH'id'stakedChange'value'150M AETH Pool'id'holdersValue'value'1+'id'holdersChange'value'Growing']defaults.forEachidvalue=>const el = document.getElementByIdidifel &&el.textContent === 'Loading...' || el.textContent === '--'el.textContent = valueconsole.log'‚úÖ Default values set'function handleEthereumInitconsole.log'Ethereum initialized event fired'checkWalletStatusasync function detectWalletWithRetryconst delays = [5001000200030004000]forlet i = 0i < delays.lengthi++await new Promiseresolve => setTimeoutresolvedelays[i]console.log`Detection attempt $i + 1/$delays.length`const detected = await checkWalletStatusifdetectedconsole.log'Wallet detected successfully!'tryconst accounts = await window.ethereum.requestmethod'eth_accounts'ifaccounts.length > 0await connectWalletcatcherrorconsole.log'Could not check existing accounts'errorbreakasync function checkWalletStatusconst statusDiv = document.getElementById'walletStatus'if!statusDivconsole.warn'Wallet status element not found - page may not be fully loaded'return falseconsole.log'Checking wallet status...'console.log'window.ethereum exists'!!window.ethereumconsole.log'window.ethereum.isMetaMask'window.ethereum?.isMetaMaskconsole.log'window.ethereum.isCoinbaseWallet'window.ethereum?.isCoinbaseWalletconsole.log'window.ethereum providers'window.ethereum?.providerslet isSupportedWallet = falselet walletName = ''ifwindow.ethereum?.isCoinbaseWalletisSupportedWallet = truewalletName = 'Coinbase Wallet'else ifwindow.ethereum?.isMetaMaskisSupportedWallet = truewalletName = 'MetaMask'ifwindow.ethereum?.providersconst coinbaseProvider = window.ethereum.providers.findp => p.isCoinbaseWalletconst metamaskProvider = window.ethereum.providers.findp => p.isMetaMaskifcoinbaseProviderisSupportedWallet = truewalletName = 'Coinbase Wallet'console.log'Found Coinbase Wallet in providers array'else ifmetamaskProviderisSupportedWallet = truewalletName = 'MetaMask'console.log'Found MetaMask in providers array'ifisSupportedWalletstatusDiv.innerHTML = `<i class="fas fa-check-circle" style="colorvar--success"></i> $walletNameDetected ‚úì<br><small style="color#6b7280">Ready to connect</small>`statusDiv.style.background = 'linear-gradient135degrgba161851290.1rgba51501050.1'statusDiv.style.border = '2px solid var--success'return trueelse ifwindow.ethereumstatusDiv.innerHTML = '<i class="fas fa-exclamation-triangle" style="colorvar--warning"></i> Other wallet detected<br><small style="color#6b7280">Coinbase Wallet or MetaMask not found</small>'statusDiv.style.background = 'linear-gradient135degrgba245158110.1rgba21711960.1'statusDiv.style.border = '2px solid var--warning'return falseelsestatusDiv.innerHTML = '<i class="fas fa-times-circle" style="colorvar--danger"></i> Wallet Not Detected<br><small style="color#6b7280">Install Coinbase Wallet or MetaMask & refresh page</small>'statusDiv.style.background = 'linear-gradient135degrgba23968680.1rgba22038380.1'statusDiv.style.border = '2px solid var--danger'return falseasync function recheckWalletconst statusDiv = document.getElementById'walletStatus'if!statusDivconsole.warn'Wallet status element not found'returnstatusDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Rechecking...'let detected = falseforlet i = 0i < 3i++await new Promiseresolve => setTimeoutresolve500detected = await checkWalletStatusifdetectedbreakifdetectedalert'‚úÖ Wallet detected!\n\nYou can now click the "Connect Wallet" button in the navbar to connect your wallet.'elseconst action = confirm'‚ùå Wallet still not detected.\n\n' + 'Troubleshooting steps\n' + '1. Close and reopen your browser\n' + '2. Make sure your wallet extension is enabled\n' + '3. Click the wallet extension icon once\n' + '4. Refresh this pageF5 or Ctrl+R\n\n' + 'Press OK to see debug infoor Cancel to try installing Coinbase Wallet.'ifactionalert'Debug Info\n\n' + 'window.ethereum exists' + !!window.ethereum + '\n' + 'window.ethereum.isCoinbaseWallet' + window.ethereum?.isCoinbaseWallet + '\n' + 'window.ethereum.isMetaMask' + window.ethereum?.isMetaMask + '\n' + 'Browser' + navigator.userAgent + '\n\n' + 'Check browser consoleF12for more details.'elsewindow.open'https//www.coinbase.com/wallet''_blank'// Staking function async function stakeTokenspoolIdif!accountshowAlert'Please connect your wallet first''error''stakingAlert'returnconst amountInput = document.getElementById`stakeAmount$poolId`const amount = amountInput.valueif!amount || amount <= 0showAlert'Please enter a valid amount to stake''error''stakingAlert'returnconst stakeBtn = document.getElementById`stakeBtn$poolId`const originalText = stakeBtn.innerHTMLstakeBtn.disabled = truestakeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...'tryshowAlert'Approving tokens for staking...''info''stakingAlert'// Approve tokens const amountWei = ethers.utils.parseEtheramountconst approvalTx = await aethContract.approveSTAKING_ADDRESSamountWeiawait approvalTx.waitshowAlert'Staking tokens...''info''stakingAlert'// Stake tokens const stakeTx = await stakingContract.stakepoolIdamountWeiawait stakeTx.waitshowToast'Success!'`$amountAETH staked successfully!`'success'showAlert`Successfully staked $amountAETH in pool $poolId + 1!`'success''stakingSuccess'amountInput.value = ''// Update stats await updateStatsawait loadUserStakescatcherrorconsole.error'Staking error'errorshowToast'Staking Failed'error.message || 'Failed to stake tokens''error'showAlert'Staking failed' + error.message'error''stakingAlert'finallystakeBtn.disabled = falsestakeBtn.innerHTML = originalText// Helper function to show alerts function showAlertmessagetypealertIdconst alertEl = document.getElementByIdalertIdifalertElalertEl.textContent = messagealertEl.className = `alert alert-$type`alertEl.classList.remove'hidden'setTimeout=>alertEl.classList.add'hidden'5000// Update stats function async function updateStatstry// Update price from DexScreener await updatePrice// Update contract stats if connected ifaethContract && accountawait updateBalances// Update staking pool stats ifstakingContractawait updateStakingStatsconsole.log'Stats updated successfully'catcherrorconsole.error'Error updating stats'error// Update price from DexScreener async function updatePricetryconsole.log'üìä Fetching live price data...'const response = await fetch'https//api.dexscreener.com/latest/dex/tokens/0xAb5ae0D8f569d7c2B27574319b864a5bA6F9671e'if!response.okthrow new Error`HTTP error! status$response.status`const data = await response.jsonifdata.pairs && data.pairs.length > 0const pair = data.pairs[0]const price = parseFloatpair.priceUsd|| 0const priceChange = parseFloatpair.priceChange?.h24 || 0const volume24h = parseFloatpair.volume?.h24 || 0const liquidity = parseFloatpair.liquidity?.usd || 0const fdv = parseFloatpair.fdv || 0// Update price const priceEl = document.getElementById'priceValue'ifpriceElifprice > 0priceEl.textContent = price >= 0.01 ? `$$price.toFixed4``$$price.toFixed8`elsepriceEl.textContent = '$0.00000001'// Update price change const changeEl = document.getElementById'priceChange'ifchangeElchangeEl.textContent = `$priceChange >= 0 ? '+'''$priceChange.toFixed2%24h`changeEl.className = `change $priceChange >= 0 ? 'positive''negative'`// Update market capusing FDV or calculating from priceconst marketCapEl = document.getElementById'marketCapValue'ifmarketCapEllet marketCap = fdvif!marketCap && price > 0 && aethContracttryconst totalSupply = await aethContract.totalSupplyconst supply = parseFloatethers.utils.formatEthertotalSupplymarketCap = price * supplycatchemarketCap = price * 1000000000// Fallbackuse 1B tokensifmarketCap >= 1000000marketCapEl.textContent = `$$marketCap / 1000000.toFixed2M`else ifmarketCap >= 1000marketCapEl.textContent = `$$marketCap / 1000.toFixed1K`elsemarketCapEl.textContent = `$$marketCap.toFixed0`// Update market cap change const marketCapChangeEl = document.getElementById'marketCapChange'ifmarketCapChangeElmarketCapChangeEl.textContent = `$priceChange >= 0 ? '+'''$priceChange.toFixed2%24h`marketCapChangeEl.className = `change $priceChange >= 0 ? 'positive''negative'`// Update volume const volumeEl = document.getElementById'volumeValue'ifvolumeElifvolume24h >= 1000000volumeEl.textContent = `$$volume24h / 1000000.toFixed2M`else ifvolume24h >= 1000volumeEl.textContent = `$$volume24h / 1000.toFixed1K`elsevolumeEl.textContent = `$$volume24h.toFixed0`// Update liquidity const liquidityEl = document.getElementById'liquidityValue'ifliquidityElifliquidity >= 1000000liquidityEl.textContent = `$$liquidity / 1000000.toFixed2M`else ifliquidity >= 1000liquidityEl.textContent = `$$liquidity / 1000.toFixed1K`elseliquidityEl.textContent = `$$liquidity.toFixed0`console.log'‚úÖ Live price updated'price'| Market Cap'marketCapelseconsole.warn'‚ö†Ô∏è No price data available yet - showing defaults'// Show default values instead of "Loading..." const priceEl = document.getElementById'priceValue'ifpriceEl && priceEl.textContent === 'Loading...'priceEl.textContent = '$0.00000001'const marketCapEl = document.getElementById'marketCapValue'ifmarketCapEl && marketCapEl.textContent === 'Loading...'marketCapEl.textContent = '$10'catcherrorconsole.error'‚ùå Error updating price'error// Show friendly error message const priceEl = document.getElementById'priceValue'ifpriceEl && priceEl.textContent === 'Loading...'priceEl.textContent = '$0.00000001'// Update user balances async function updateBalancestryif!account || !aethContractreturnconst aethBalance = await aethContract.balanceOfaccountconst balance = parseFloatethers.utils.formatEtheraethBalanceconst balanceEl = document.getElementById'userBalance'ifbalanceElbalanceEl.textContent = balance.toFixed2+ ' AETH'// Calculate USD valueneed current priceconst priceResponse = await fetch'https//api.dexscreener.com/latest/dex/tokens/0xAb5ae0D8f569d7c2B27574319b864a5bA6F9671e'const priceData = await priceResponse.jsonifpriceData.pairs && priceData.pairs.length > 0const price = parseFloatpriceData.pairs[0].priceUsdconst usdValue = balance * priceconst usdEl = document.getElementById'userBalanceUSD'ifusdElusdEl.textContent = `$$usdValue.toFixed2USD`console.log'‚úÖ Balance updated'balance'AETH'catcherrorconsole.error'‚ùå Error updating balances'error// Update staking pool statistics async function updateStakingStatstryif!stakingContractconsole.warn'‚ö†Ô∏è Staking contract not initialized - keeping defaults'returnconsole.log'üìä Fetching live staking data...'// Add timeout to prevent hanging const timeout = new Promise_reject=> setTimeout=> rejectnew Error'Timeout'10000// Race between the blockchain call and timeout const totalStakedPromise = stakingContract.totalStakedconst totalStaked = await Promise.race[totalStakedPromisetimeout]const total = parseFloatethers.utils.formatEthertotalStakedconst stakedEl = document.getElementById'stakedValue'ifstakedEliftotal >= 1000000stakedEl.textContent = `$total / 1000000.toFixed2M AETH`else iftotal >= 1000stakedEl.textContent = `$total / 1000.toFixed1K AETH`else iftotal > 0stakedEl.textContent = `$total.toFixed0AETH`elsestakedEl.textContent = '0 AETH'// Update change text const stakedChangeEl = document.getElementById'stakedChange'ifstakedChangeElstakedChangeEl.textContent = '150M AETH Pool'// Get token total supply for percentage calculation ifaethContracttryconst totalSupplyPromise = aethContract.totalSupplyconst totalSupply = await Promise.race[totalSupplyPromisetimeout]const supply = parseFloatethers.utils.formatEthertotalSupplyconst stakedPercentage =total / supply* 100const stakedPctEl = document.getElementById'stakedPercentage'ifstakedPctElstakedPctEl.textContent = `$stakedPercentage.toFixed1% of supply`catcheconsole.warn'‚ö†Ô∏è Could not fetch total supply'e.message// Update holders countestimateconst holdersEl = document.getElementById'holdersValue'ifholdersEliftotal > 0const estimatedHolders = Math.max1Math.floortotal / 10000holdersEl.textContent = `$estimatedHolders+`elseholdersEl.textContent = '1+'console.log'‚úÖ Staking stats updated'total'AETH staked'catcherroriferror.message === 'Timeout'console.warn'‚ö†Ô∏è Blockchain call timed out - keeping previous values'elseconsole.error'‚ùå Error updating staking stats'error.message// Keep the default values that were already set - don't revert to "Loading..."// Connect wallet function async function connectWalletiftypeof window.ethereum === 'undefined'alert'No Ethereum wallet detected! Please\n1. Install MetaMask or Coinbase Wallet\n2. Refresh this page\n3. Make sure you\'re using a compatible browser'window.open'https//metamask.io/download/''_blank'returntryprovider = new ethers.providers.Web3Providerwindow.ethereumawait provider.send"eth_requestAccounts"[]signer = provider.getSigneraccount = await signer.getAddress// Switch to Polygon network tryawait window.ethereum.requestmethod'wallet_switchEthereumChain'params[chainIdPOLYGON_CHAIN_ID]catchswitchError// This error code indicates that the chain has not been added to MetaMask ifswitchError.code === 4902tryawait window.ethereum.requestmethod'wallet_addEthereumChain'params[chainIdPOLYGON_CHAIN_IDchainName'Polygon Mainnet'nativeCurrencyname'MATIC'symbol'MATIC'decimals18rpcUrls['https//polygon-rpc.com/']blockExplorerUrls['https//polygonscan.com/']]catchaddErrorconsole.error'Error adding Polygon network'addErroraethContract = new ethers.ContractAETH_ADDRESSAETH_ABIsignerstakingContract = new ethers.ContractSTAKING_ADDRESSSTAKING_ABIsignerconsole.log'\u2705 Wallet connected! Address'accountconsole.log'\ud83d\udd17 Contracts initialized with wallet signer'document.getElementById'connectBtn'.textContent = 'Connected ‚úì'document.getElementById'connectBtn'.classList.add'connected'document.getElementById'walletConnected'.classList.remove'hidden'document.getElementById'walletNotConnected'.classList.add'hidden'document.getElementById'walletAddress'.textContent = account.slice06+ '...' + account.slice-4// Update transaction history UI document.getElementById'txNotConnected'.classList.add'hidden'document.getElementById'txConnected'.classList.remove'hidden'// Load user data showProgressawait updateStatsawait loadUserStakesawait loadTransactionHistoryhideProgressshowToast'Connected!'`Wallet $account.slice06...$account.slice-4connected`'success'catcherrorconsole.error'Error connecting'errorhideProgressshowToast'Connection Failed'error.message || 'Failed to connect wallet''error'showAlert'Failed to connect' + error.message'error''stakingAlert'// Disconnect wallet function async function disconnectWalletaccount = nullsigner = nullaethContract = nullstakingContract = nulldocument.getElementById'connectBtn'.textContent = 'Connect Wallet'document.getElementById'connectBtn'.classList.remove'connected'document.getElementById'walletConnected'.classList.add'hidden'document.getElementById'walletNotConnected'.classList.remove'hidden'document.getElementById'txConnected'.classList.add'hidden'document.getElementById'txNotConnected'.classList.remove'hidden'// Remove user stakes container if exists const stakesContainer = document.getElementById'userStakesContainer'ifstakesContainerstakesContainer.removeshowToast'Disconnected''Wallet disconnected successfully''info'console.log'\ud83d\udd0c Wallet disconnected'// Add token to wallet function async function addTokenToWalletif!window.ethereumalert'No Ethereum wallet detected!'returntryawait window.ethereum.requestmethod'wallet_watchAsset'paramstype'ERC20'optionsaddressAETH_ADDRESSsymbol'AETH'decimals18image'https//raw.githubusercontent.com/MastaTrill/Aetheron_platform/main/aetheron-logo.svg'showAlert'AETH token added to wallet!''success''stakingSuccess'catcherrorconsole.error'Error adding token'errorshowAlert'Failed to add token' + error.message'error''stakingAlert'// Calculate rewards function async function calculateRewardsif!accountshowAlert'Please connect your wallet first''error''stakingAlert'returnconst stakeId = document.getElementById'stakeId'.valueif!stakeIdshowAlert'Please enter a stake ID''error''stakingAlert'returntryconst reward = await stakingContract.calculateRewardaccountstakeIddocument.getElementById'calculatedReward'.textContent = ethers.utils.formatEtherreward+ ' AETH'showAlert'Reward calculated successfully!''success''stakingSuccess'catcherrorconsole.error'Error calculating reward'errorshowAlert'Failed to calculate reward' + error.message'error''stakingAlert'// Refresh transactions function async function refreshTransactionsawait updateStatsshowAlert'Transactions refreshed!''success''stakingSuccess'// Owner functionsonly work if connected wallet is ownerasync function updateTaxesif!account || account.toLowerCase!== OWNER_ADDRESSshowAlert'Only contract owner can update taxes''error''stakingAlert'returnconst buyTax = document.getElementById'buyTax'.valueconst sellTax = document.getElementById'sellTax'.valuetryconst tx = await aethContract.updateTaxesbuyTaxsellTaxawait tx.waitshowAlert'Taxes updated successfully!''success''stakingSuccess'catcherrorconsole.error'Error updating taxes'errorshowAlert'Failed to update taxes' + error.message'error''stakingAlert'async function pauseTradingif!account || account.toLowerCase!== OWNER_ADDRESSshowAlert'Only contract owner can pause trading''error''stakingAlert'returntryconst tx = await aethContract.pauseawait tx.waitshowAlert'Trading paused successfully!''success''stakingSuccess'catcherrorconsole.error'Error pausing trading'errorshowAlert'Failed to pause trading' + error.message'error''stakingAlert'async function unpauseTradingif!account || account.toLowerCase!== OWNER_ADDRESSshowAlert'Only contract owner can unpause trading''error''stakingAlert'returntryconst tx = await aethContract.unpauseawait tx.waitshowAlert'Trading unpaused successfully!''success''stakingSuccess'catcherrorconsole.error'Error unpausing trading'errorshowAlert'Failed to unpause trading' + error.message'error''stakingAlert'async function withdrawTreasuryif!account || account.toLowerCase!== OWNER_ADDRESSshowAlert'Only contract owner can withdraw treasury''error''stakingAlert'returntryconst tx = await aethContract.withdrawTreasuryawait tx.waitshowAlert'Treasury withdrawn successfully!''success''stakingSuccess'catcherrorconsole.error'Error withdrawing treasury'errorshowAlert'Failed to withdraw treasury' + error.message'error''stakingAlert'async function emergencyWithdrawif!account || account.toLowerCase!== OWNER_ADDRESSshowAlert'Only contract owner can perform emergency withdraw''error''stakingAlert'returntryconst tx = await stakingContract.emergencyWithdrawawait tx.waitshowAlert'Emergency withdraw completed!''success''stakingSuccess'catcherrorconsole.error'Error emergency withdraw'errorshowAlert'Failed emergency withdraw' + error.message'error''stakingAlert'async function rescueTokensif!account || account.toLowerCase!== OWNER_ADDRESSshowAlert'Only contract owner can rescue tokens''error''stakingAlert'returnconst tokenAddress = document.getElementById'rescueToken'.valueconst amount = document.getElementById'rescueAmount'.valuetryconst tx = await aethContract.rescueTokenstokenAddressethers.utils.parseEtheramountawait tx.waitshowAlert'Tokens rescued successfully!''success''stakingSuccess'catcherrorconsole.error'Error rescuing tokens'errorshowAlert'Failed to rescue tokens' + error.message'error''stakingAlert'// ============================================ // NEW FEATURES - February 2026 // ============================================ // Add AETH to MetaMask async function addToMetaMaskiftypeof window.ethereum === 'undefined'alert'Please install MetaMask first!'returntryconst wasAdded = await window.ethereum.requestmethod'wallet_watchAsset'paramstype'ERC20'optionsaddressAETH_ADDRESSsymbol'AETH'decimals18image'https//raw.githubusercontent.com/MastaTrill/Aetheron_platform/main/assets/logo.png'ifwasAddedshowAlert'AETH added to MetaMask!''success'catcherrorconsole.error'Error adding to MetaMask'errorshowAlert'Failed to add token to MetaMask''error'// Copy contract address function copyContractAddressconst contractAddress = AETH_ADDRESSnavigator.clipboard.writeTextcontractAddress.then=>const btn = document.getElementById'copyBtnText'const copyBtn = document.getElementById'copyContractBtn'btn.textContent = 'Copied! ‚úì'copyBtn.classList.add'copied'setTimeout=>btn.textContent = '0xAb5a...71e'copyBtn.classList.remove'copied'2000.catcherr =>console.error'Failed to copy'erralert'Failed to copy address'// Update live holder count async function updateHolderCounttry// Estimate holders based on total supply and average holding // In productionyou'd query this from a backend or indexer const response = await fetch`https//api.dexscreener.com/latest/dex/tokens/$AETH_ADDRESS`const data = await response.jsonifdata.pairs && data.pairs.length > 0// Rough estimateuse transaction count or volume as proxy const txCount = data.pairs[0].txns?.h24?.total || 0const estimatedHolders = Math.maxMath.floortxCount / 2+ 50100document.getElementById'liveHoldersCount'.textContent = estimatedHolders + '+'catcherrorconsole.log'Could not fetch holder count'errordocument.getElementById'liveHoldersCount'.textContent = '100+'// Toggle FAQ accordion function toggleFAQindexconst answer = document.getElementById`faq-answer-$index`const toggle = document.getElementById`faq-toggle-$index`answer.classList.toggle'active'toggle.classList.toggle'active'// Enhanced price update with change indicator let lastPrice = nullasync function updatePriceWithChangetryconst response = await fetch`https//api.dexscreener.com/latest/dex/tokens/$AETH_ADDRESS`const data = await response.jsonifdata.pairs && data.pairs.length > 0const pair = data.pairs[0]const currentPrice = parseFloatpair.priceUsdconst priceChange = parseFloatpair.priceChange?.h24 || 0// Update price value document.getElementById'priceValue'.textContent = `$$currentPrice.toFixed8`// Update price change indicator const arrow = document.getElementById'priceArrow'const changePercent = document.getElementById'priceChangePercent'const changeDiv = document.getElementById'priceChange'ifpriceChange >= 0arrow.className = 'fas fa-arrow-up'changeDiv.className = 'change positive'changePercent.textContent = `+$priceChange.toFixed2%`elsearrow.className = 'fas fa-arrow-down'changeDiv.className = 'change negative'changePercent.textContent = `$priceChange.toFixed2%`lastPrice = currentPricecatcherrorconsole.log'Could not update price with change'error// QR Code Modal Functions function showQRCodeconst modal = document.getElementById'qrModal'const qrcodeContainer = document.getElementById'qrcode'// Clear previous QR code qrcodeContainer.innerHTML = ''// Generate new QR code new QRCodeqrcodeContainertextAETH_ADDRESSwidth256height256colorDark"#000000"colorLight"#ffffff"correctLevelQRCode.CorrectLevel.Hmodal.style.display = 'block'// Track event iftypeof gtag !== 'undefined'gtag'event''show_qr_code''event_category''engagement''event_label''contract_qr'function closeQRModaldocument.getElementById'qrModal'.style.display = 'none'// Share Modal Functions function showShareModaldocument.getElementById'shareModal'.style.display = 'block'// Track event iftypeof gtag !== 'undefined'gtag'event''show_share_modal''event_category''engagement''event_label''share_button'function closeShareModaldocument.getElementById'shareModal'.style.display = 'none'function shareTwitterconst text = encodeURIComponent'üöÄ Join AetheronAETH- Revolutionary DeFi platform with up to 50% APY staking rewards! üíé\n\nüéØ Features\n‚úÖ Gamified Leaderboards\n‚úÖ Referral Rewards5%\n‚úÖ Transparent Roadmap\n\n#Aetheron #DeFi #Crypto'const url = encodeURIComponent'https//mastatrill.github.io/Aetheron_platform/'window.open`https//twitter.com/intent/tweet?text=$text&url=$url`'_blank'trackShare'twitter'function shareFacebookconst url = encodeURIComponent'https//mastatrill.github.io/Aetheron_platform/'window.open`https//www.facebook.com/sharer/sharer.php?u=$url`'_blank'trackShare'facebook'function shareTelegramconst text = encodeURIComponent'üöÄ Join AetheronAETH- Revolutionary DeFi platform with up to 50% APY staking rewards!'const url = encodeURIComponent'https//mastatrill.github.io/Aetheron_platform/'window.open`https//t.me/share/url?url=$url&text=$text`'_blank'trackShare'telegram'function shareLinkedInconst url = encodeURIComponent'https//mastatrill.github.io/Aetheron_platform/'window.open`https//www.linkedin.com/sharing/share-offsite/?url=$url`'_blank'trackShare'linkedin'function copyShareLinkconst url = 'https//mastatrill.github.io/Aetheron_platform/'navigator.clipboard.writeTexturl.then=>const btn = event.target.closest'.share-btn'const originalText = btn.innerHTMLbtn.innerHTML = '<i class="fas fa-check"></i> Copied!'btn.style.background = 'var--success'setTimeout=>btn.innerHTML = originalTextbtn.style.background = 'linear-gradient135degvar--primaryvar--secondary'2000trackShare'copy_link'.catcherr =>console.error'Failed to copy'erralert'Failed to copy link'function trackShareplatformiftypeof gtag !== 'undefined'gtag'event''share''event_category''social''event_label'platform'value'1// Close modals when clicking outside window.onclick = functioneventconst qrModal = document.getElementById'qrModal'const shareModal = document.getElementById'shareModal'ifevent.target === qrModalcloseQRModalifevent.target === shareModalcloseShareModal// Theme Toggle Functionality function initThemeconst savedTheme = localStorage.getItem'theme'|| 'dark'document.documentElement.setAttribute'data-theme'savedThemeupdateThemeIconsavedThemefunction toggleThemeconst currentTheme = document.documentElement.getAttribute'data-theme'|| 'dark'const newTheme = currentTheme === 'dark' ? 'light''dark'document.documentElement.setAttribute'data-theme'newThemelocalStorage.setItem'theme'newThemeupdateThemeIconnewTheme// Track event iftypeof gtag !== 'undefined'gtag'event''theme_toggle''event_category''ui''event_label'newTheme'value'1function updateThemeIconthemeconst icon = document.getElementById'themeIcon'ificonicon.className = theme === 'dark' ? 'fas fa-sun''fas fa-moon'// Initialize theme on load initTheme// Newsletter Signup Handler async function handleNewsletterSignupeventevent.preventDefaultconst emailInput = document.getElementById'emailInput'const messageDiv = document.getElementById'newsletterMessage'const email = emailInput.value.trimif!emailreturn// Validate email const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/if!emailRegex.testemailmessageDiv.textContent = '‚ùå Please enter a valid email address'messageDiv.className = 'newsletter-message error'return// Store in localStoragein productionsend to backendconst preferences =emailgovernancedocument.querySelector'.notification-options inputnth-child1'.checkedfeaturesdocument.querySelector'.notification-options inputnth-child2'.checkedpriceAlertsdocument.querySelector'.notification-options inputnth-child3'.checkeddigestdocument.querySelector'.notification-options inputnth-child4'.checkedtimestampnew Date.toISOStringlocalStorage.setItem'emailNotificationPrefs'JSON.stringifypreferences// Request push notification permission if'Notification' in window && 'serviceWorker' in navigatortryconst permission = await Notification.requestPermissionifpermission === 'granted'// Subscribe to push notifications const registration = await navigator.serviceWorker.readytryconst subscription = await registration.pushManager.subscribeuserVisibleOnlytrueapplicationServerKeyurlBase64ToUint8Array'YOUR_VAPID_PUBLIC_KEY'// Replace with real VAPID keyconsole.log'Push subscription'subscriptioncatcherrconsole.log'Push subscription failed'errcatcherrconsole.log'Notification permission error'errmessageDiv.textContent = '‚úÖ Successfully subscribed! You\'ll receive notifications for selected topics.'messageDiv.className = 'newsletter-message success'emailInput.value = ''// Track event iftypeof gtag !== 'undefined'gtag'event''newsletter_signup''event_category''engagement''event_label'email'value'1// Show test notification setTimeout=>ifNotification.permission === 'granted'new Notification'Welcome to Aetheron! üöÄ'body'You\'ll now receive updates about governance votes and platform features.'icon'/assets/icon-192.png'badge'/assets/icon-72.png'1000// Helper function for push notifications function urlBase64ToUint8Arraybase64Stringconst padding = '='.repeat4 - base64String.length % 4% 4const base64 =base64String + padding.replace/-/g'+'.replace/_/g'/'const rawData = window.atobbase64const outputArray = new Uint8ArrayrawData.lengthforlet i = 0i < rawData.length++ioutputArray[i] = rawData.charCodeAtireturn outputArray// Initialize new features on page load iftypeof window !== 'undefined'window.addEventListener'load'=>// Hook up MetaMask button const addToMetaMaskBtn = document.getElementById'addToMetaMaskBtn'ifaddToMetaMaskBtnaddToMetaMaskBtn.addEventListener'click'addToMetaMask// Hook up copy button const copyBtn = document.getElementById'copyContractBtn'ifcopyBtncopyBtn.addEventListener'click'copyContractAddress// Start holder count updates updateHolderCountsetIntervalupdateHolderCount60000// Update every minute // Enhanced price updates updatePriceWithChangesetIntervalupdatePriceWithChange30000// Update every 30 seconds // Hook up QR code and share buttons const qrBtn = document.getElementById'qrCodeBtn'ifqrBtnqrBtn.addEventListener'click'showQRCodeconst shareBtn = document.getElementById'shareBtn'ifshareBtnshareBtn.addEventListener'click'showShareModal// Hook up theme toggle const themeToggle = document.getElementById'themeToggle'ifthemeTogglethemeToggle.addEventListener'click'toggleTheme// Hook up newsletter form const newsletterForm = document.getElementById'newsletterForm'ifnewsletterFormnewsletterForm.addEventListener'submit'handleNewsletterSignup// ============================================================================ // WebSocket Real-Time Updates // ============================================================================ function initializeWebSocketconsole.log'üîå Initializing WebSocket for real-time updates...'// Connect to Polygon mainnet via Alchemy WebSocketfallback to polling if unavailabletry// Use Alchemy's WebSocket for Polygon const wsProvider = new ethers.providers.WebSocketProvider'wss//polygon-mainnet.g.alchemy.com/v2/demo' // Use your own key in productionwsProvider.on'error'error=>console.warn'‚ö†Ô∏è WebSocket error'error.messagereconnectWebSocketwsProvider.on'close'=>console.log'üîå WebSocket connection closed'reconnectWebSocket// Listen for new blocksreal-time blockchain updateswsProvider.on'block'asyncblockNumber=>console.log`üì¶ New block$blockNumber`// Update stats when new block arrivesthrottledifblockNumber % 10 === 0// Every 10 blocks~20 secondsawait updateStakingStatsawait updateLiveHolders// Listen for Transfer events on AETH contract ifaethContractconst filter = aethContract.filters.TransferwsProvider.onfilterlog=>console.log'üí∏ New AETH transfer detected'updateLiveHoldersconsole.log'‚úÖ WebSocket connected for real-time updates'reconnectAttempts = 0catcherrorconsole.warn'‚ö†Ô∏è WebSocket not availableusing polling fallback'error.message// Initialize DexScreener price updates via more frequent polling initializePriceStreamfunction reconnectWebSocketifreconnectAttempts < MAX_RECONNECT_ATTEMPTSreconnectAttempts++const delay = Math.min1000 * Math.pow2reconnectAttempts30000console.log`üîÑ Reconnecting WebSocket in $delay/1000sattempt $reconnectAttempts/$MAX_RECONNECT_ATTEMPTS...`setTimeoutinitializeWebSocketdelayelseconsole.log'‚ùå Max WebSocket reconnection attempts reached. Using polling only.'function initializePriceStream// DexScreener doesn't provide WebSocketso we'll use more frequent polling for price const priceUpdateInterval = setIntervalasync=>await updatePriceWithChange10000// Update price every 10 seconds for near real-time experience console.log'üìä Real-time price updates initialized10s interval'// Clean up on page unload window.addEventListener'beforeunload'=>clearIntervalpriceUpdateIntervalifpriceWebSocketpriceWebSocket.close// ============================================================================ // Service Worker RegistrationProgressive Web App// ============================================================================ // Register Service Workermoved from inline scriptif'serviceWorker' in navigatorwindow.addEventListener'load'=>navigator.serviceWorker.register'./service-worker.js'.thenregistration =>console.log'‚úÖ Service Worker registered'registration.scope.catcherror =>console.log'‚ùå Service Worker registration failed'error// ============================================================================ // Toast Notification System // ============================================================================ function showToasttitlemessagetype = 'success'const container = document.getElementById'toastContainer'if!containerreturnconst toast = document.createElement'div'toast.className = `toast $type`toast.setAttribute'role''alert'const icons =success'fa-check-circle'error'fa-exclamation-circle'warning'fa-exclamation-triangle'info'fa-info-circle'toast.innerHTML = ` <i class="fas $icons[type]toast-icon" aria-hidden="true"></i> <div class="toast-content"> <div class="toast-title">$title</div> <div class="toast-message">$message</div> </div> <i class="fas fa-times toast-close" aria-label="Close notification"></i> `container.appendChildtoast// Close button toast.querySelector'.toast-close'.addEventListener'click'=>toast.style.animation = 'slideIn 0.3s ease-out reverse'setTimeout=> toast.remove300// Auto remove after 5 seconds setTimeout=>iftoast.parentElementtoast.style.animation = 'slideIn 0.3s ease-out reverse'setTimeout=> toast.remove3005000// ============================================================================ // Mobile Menu // ============================================================================ function initMobileMenuconst hamburger = document.getElementById'hamburger'const navLinks = document.getElementById'navLinks'const overlay = document.getElementById'mobileMenuOverlay'if!hamburger || !navLinks || !overlayreturnfunction toggleMenuconst isActive = hamburger.classList.toggle'active'navLinks.classList.toggle'active'overlay.classList.toggle'active'hamburger.setAttribute'aria-expanded'isActivedocument.body.style.overflow = isActive ? 'hidden'''function closeMenuhamburger.classList.remove'active'navLinks.classList.remove'active'overlay.classList.remove'active'hamburger.setAttribute'aria-expanded''false'document.body.style.overflow = ''hamburger.addEventListener'click'toggleMenuoverlay.addEventListener'click'closeMenu// Close menu when clicking nav links navLinks.querySelectorAll'.nav-link'.forEachlink =>link.addEventListener'click'closeMenu// ============================================================================ // Progress Bar // ============================================================================ function initProgressBarconst progressBar = document.getElementById'progressBar'if!progressBarreturn// Show progress on page navigation document.querySelectorAll'a'.forEachlink =>link.addEventListener'click'e=>iflink.href && !link.href.startsWith'javascript'&& !link.targetprogressBar.classList.add'active'function showProgressconst progressBar = document.getElementById'progressBar'ifprogressBarprogressBar.classList.add'active'function hideProgressconst progressBar = document.getElementById'progressBar'ifprogressBarsetTimeout=> progressBar.classList.remove'active'300// ============================================================================ // Data Caching System // ============================================================================ const cache =setkeyvaluettl = 60000// Default 1 minute TTL const item =valueexpiryDate.now+ ttltrylocalStorage.setItem`aeth_cache_$key`JSON.stringifyitemcatcheconsole.warn'Cache storage failed'egetkeytryconst itemStr = localStorage.getItem`aeth_cache_$key`if!itemStrreturn nullconst item = JSON.parseitemStrifDate.now> item.expirylocalStorage.removeItem`aeth_cache_$key`return nullreturn item.valuecatchereturn nullclearObject.keyslocalStorage.forEachkey =>ifkey.startsWith'aeth_cache_'localStorage.removeItemkey// ============================================================================ // User Stakes Dashboard // ============================================================================ async function loadUserStakesif!account || !stakingContractconsole.log'No account connected for stakes'returntryshowProgressconst stakesCount = await stakingContract.getUserStakesCountaccountconst stakes = []forlet i = 0i < stakesCounti++tryconst stake = await stakingContract.getUserStakeaccountistakes.pushidiamountethers.utils.formatEtherstake.amountpoolIdstake.poolId.toNumberstartTimenew Datestake.startTime.toNumber* 1000unlockTimenew Datestake.unlockTime.toNumber* 1000pendingRewardethers.utils.formatEtherstake.pendingRewardcatcherrorconsole.warn`Failed to load stake $i`errordisplayUserStakesstakeshideProgressifstakes.length > 0showToast'Stakes Loaded'`Found $stakes.lengthactive stakes`'success'catcherrorconsole.error'Error loading user stakes'errorhideProgressshowToast'Error''Failed to load your stakes''error'function displayUserStakesstakes// Find or create stakes container let container = document.getElementById'userStakesContainer'if!containerconst walletCard = document.querySelector'.card.mb-2'ifwalletCardcontainer = document.createElement'div'container.id = 'userStakesContainer'container.className = 'card mb-2'container.innerHTML = ` <div class="card-header"> <h2 class="card-title">Your Active Stakes</h2> <button class="btn btn-outline btn-sm" onclick="loadUserStakes"> <i class="fas fa-sync-alt"></i> Refresh </button> </div> <div class="user-stakes" id="userStakesList"></div> `walletCard.parentNode.insertBeforecontainerwalletCard.nextSiblingconst list = document.getElementById'userStakesList'if!listreturnifstakes.length === 0list.innerHTML = ` <div class="wallet-section"> <i class="fas fa-inbox empty-icon"></i> <p class="text-gray">No active stakes yet. Start staking to earn rewards!</p> </div> `returnconst poolNames = ['30 Days5% APY''90 Days12% APY''180 Days25% APY']list.innerHTML = stakes.mapstake =>const isUnlocked = new Date>= stake.unlockTimeconst status = isUnlocked ? 'completed''active'const statusText = isUnlocked ? 'Unlocked''Locked'return ` <div class="stake-item slide-up"> <div class="stake-header"> <div> <div class="fw-600">$poolNames[stake.poolId] || 'Unknown Pool'</div> <div class="text-sm text-gray">Stake #$stake.id</div> </div> <span class="stake-badge $status">$statusText</span> </div> <div class="stake-details"> <div class="stake-detail-item"> <span class="stake-detail-label">Staked Amount</span> <span class="stake-detail-value">$parseFloatstake.amount.toFixed2AETH</span> </div> <div class="stake-detail-item"> <span class="stake-detail-label">Pending Rewards</span> <span class="stake-detail-value">$parseFloatstake.pendingReward.toFixed4AETH</span> </div> <div class="stake-detail-item"> <span class="stake-detail-label">Started</span> <span class="stake-detail-value">$stake.startTime.toLocaleDateString</span> </div> <div class="stake-detail-item"> <span class="stake-detail-label">Unlock Date</span> <span class="stake-detail-value">$stake.unlockTime.toLocaleDateString</span> </div> </div> <div class="stake-actions"> $parseFloatstake.pendingReward> 0 ? ` <button class="btn btn-success btn-sm" onclick="claimStakeRewards$stake.id" $!isUnlocked ? 'disabled'''> <i class="fas fa-coins"></i> Claim Rewards </button> `''$isUnlocked ? ` <button class="btn btn-primary btn-sm" onclick="unstakeTokens$stake.id"> <i class="fas fa-unlock"></i> Unstake </button> `` <button class="btn btn-warning btn-sm" onclick="emergencyUnstake$stake.id"> <i class="fas fa-exclamation-triangle"></i> Emergency Withdraw </button> `</div> </div> `.join''// Claim rewards from specific stake async function claimStakeRewardsstakeIdif!stakingContract || !accountshowToast'Error''Please connect your wallet first''error'returntryshowProgressshowToast'Processing''Claiming rewards...''info'const tx = await stakingContract.claimRewardsstakeIdshowToast'Transaction Sent''Waiting for confirmation...''warning'await tx.waithideProgressshowToast'Success!''Rewards claimed successfully!''success'// Refresh stakes display await loadUserStakesawait updateBalancescatcherrorconsole.error'Error claiming rewards'errorhideProgressshowToast'Error'error.message || 'Failed to claim rewards''error'// Unstake tokens async function unstakeTokensstakeIdif!stakingContract || !accountshowToast'Error''Please connect your wallet first''error'returntryshowProgressshowToast'Processing''Unstaking tokens...''info'const tx = await stakingContract.unstakestakeIdshowToast'Transaction Sent''Waiting for confirmation...''warning'await tx.waithideProgressshowToast'Success!''Tokens unstaked successfully!''success'// Refresh displays await loadUserStakesawait updateBalancescatcherrorconsole.error'Error unstaking'errorhideProgressshowToast'Error'error.message || 'Failed to unstake''error'// Emergency unstakeforfeit rewardsasync function emergencyUnstakestakeIdconst confirmed = confirm'Emergency withdraw will forfeit all rewards. Continue?'if!confirmedreturn// Same as unstake but with warning await unstakeTokensstakeId// ============================================================================ // Enhanced Transaction History // ============================================================================ async function loadTransactionHistoryif!accountreturntryshowProgress// Check cache first const cacheKey = `tx_history_$account`const cached = cache.getcacheKeyifcacheddisplayTransactionscachedhideProgressreturn// Fetch from blockchain const provider = readOnlyProvider || new ethers.providers.JsonRpcProviderPOLYGON_RPC_URLS[0]const contract = new ethers.ContractAETH_ADDRESSAETH_ABIprovider// Get Transfer events const filterFrom = contract.filters.Transferaccountnullconst filterTo = contract.filters.Transfernullaccountconst currentBlock = await provider.getBlockNumberconst fromBlock = Math.max0currentBlock - 10000// Last ~10k blocks const [sentEventsreceivedEvents] = await Promise.all[ contract.queryFilterfilterFromfromBlockcontract.queryFilterfilterTofromBlock]const allEvents = [...sentEvents...receivedEvents] .sortab=> b.blockNumber - a.blockNumber.slice020// Latest 20 transactions const transactions = await Promise.allallEvents.mapasync event =>const block = await provider.getBlockevent.blockNumberreturnhashevent.transactionHashfromevent.args.fromtoevent.args.tovalueethers.utils.formatEtherevent.args.valuetimestampnew Dateblock.timestamp * 1000typeevent.args.from.toLowerCase=== account.toLowerCase? 'send''receive'// Cache for 2 minutes cache.setcacheKeytransactions120000displayTransactionstransactionshideProgresscatcherrorconsole.error'Error loading transaction history'errorhideProgressshowToast'Error''Failed to load transaction history''error'function displayTransactionstransactionsconst list = document.getElementById'txList'if!listreturnif!transactions || transactions.length === 0document.getElementById'txEmpty'.classList.remove'hidden'list.classList.add'hidden'returndocument.getElementById'txEmpty'.classList.add'hidden'list.classList.remove'hidden'list.innerHTML = transactions.maptx => ` <div class="tx-item"> <div> <span class="tx-type $tx.type">$tx.type === 'send' ? 'Sent''Received'</span> <div class="text-sm text-gray mt-05">$tx.timestamp.toLocaleString</div> </div> <div style="text-alignright"> <div class="fw-600">$parseFloattx.value.toFixed4AETH</div> <a href="https//polygonscan.com/tx/$tx.hash" target="_blank" rel="noopener" class="text-sm" style="colorvar--primary"> View <i class="fas fa-external-link-alt"></i> </a> </div> </div> `.join''// Register service worker for PWA if'serviceWorker' in navigatornavigator.serviceWorker.register'./service-worker.js'.thenregistration => console.log'‚úÖ Service Worker registered'registration.scope.catcherror => console.error'‚ùå Service Worker registration failed'error