<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://unpkg.com https://www.googletagmanager.com https://www.google-analytics.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; connect-src 'self' https://api.coingecko.com https://api.coinmarketcap.com https://polygon-rpc.com https://rpc-mainnet.matic.network https://etherscan.io https://api.etherscan.io https://api.polygonscan.com https://polygonscan.com https://api.dexscreener.com https://dexscreener.com https://api.github.com https://github.com https://api.telegram.org https://telegram.org https://discord.com https://discordapp.com https://api.discord.com https://cdn.discordapp.com; frame-src 'self' https://www.youtube.com https://youtube.com https://player.vimeo.com https://vimeo.com;">
  <title>Transaction History - Aetheron Platform</title>
  <link rel="stylesheet" href="dashboard.css">
  <link rel="stylesheet" href="mobile-optimization.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="shared-mobile-polish.css?v=1.3.0">
</head>

<body>
  <nav class="main-nav">
    <div class="nav-container">
      <div class="nav-brand">
        <h1>AETHERON</h1>
      </div>
      <div class="nav-links"><a href="index.html"><i class="fas fa-home"></i> Dashboard</a> <a
          href="analytics-dashboard.html"><i class="fas fa-chart-bar"></i> Analytics</a> <a
          href="staking-calculator.html"><i class="fas fa-calculator"></i> Calculator</a> <a href="price-alerts.html"><i
            class="fas fa-bell"></i> Alerts</a> <a href="portfolio.html"><i class="fas fa-wallet"></i> Portfolio</a>
      </div>
    </div>
  </nav>
  <main class="main-content">
    <div class="container">
      <div class="page-header">
        <h1><i class="fas fa-history"></i> Transaction History</h1>
        <p>Complete record of all your AETH transactions</p>
      </div>
      <div class="wallet-status-card card" id="walletStatus"><button class="btn-primary btn-lg"
          onclick="connectWallet()"><i class="fas fa-wallet"></i> Connect Wallet</button></div>
      <div id="historyContent" class="hidden">
        <div class="history-stats">
          <div class="stat-box card">
            <div class="stat-icon stat-icon-blue"><i class="fas fa-exchange-alt"></i></div>
            <div class="stat-info">
              <div class="stat-label">Total Transactions</div>
              <div class="stat-value" id="totalTxs">0</div>
            </div>
          </div>
          <div class="stat-box card">
            <div class="stat-icon stat-icon-green"><i class="fas fa-arrow-up"></i></div>
            <div class="stat-info">
              <div class="stat-label">Total Staked</div>
              <div class="stat-value" id="totalStaked">0 AETH</div>
            </div>
          </div>
          <div class="stat-box card">
            <div class="stat-icon stat-icon-orange"><i class="fas fa-gift"></i></div>
            <div class="stat-info">
              <div class="stat-label">Total Rewards</div>
              <div class="stat-value" id="totalRewards">0 AETH</div>
            </div>
          </div>
          <div class="stat-box card">
            <div class="stat-icon stat-icon-red"><i class="fas fa-dollar-sign"></i></div>
            <div class="stat-info">
              <div class="stat-label">Total Fees Paid</div>
              <div class="stat-value" id="totalFees">0 MATIC</div>
            </div>
          </div>
        </div>
        <div class="filters-bar card">
          <div class="filter-group"><label for="filterType">Type:</label> <select id="filterType"
              onchange="applyFilters()">
              <option value="all">All Transactions</option>
              <option value="stake">Stake</option>
              <option value="unstake">Unstake</option>
              <option value="claim">Claim Rewards</option>
              <option value="transfer">Transfer</option>
              <option value="approval">Approval</option>
            </select></div>
          <div class="filter-group"><label for="filterTime">Time:</label> <select id="filterTime"
              onchange="applyFilters()">
              <option value="all">All Time</option>
              <option value="24h">Last 24 Hours</option>
              <option value="7d">Last 7 Days</option>
              <option value="30d">Last 30 Days</option>
              <option value="90d">Last 90 Days</option>
            </select></div>
          <div class="filter-group"><button class="btn-secondary" onclick="refreshHistory()"><i
                class="fas fa-sync-alt"></i> Refresh</button></div>
          <div class="filter-group"><button class="btn-secondary" onclick="exportHistory()"><i
                class="fas fa-download"></i> Export CSV</button></div>
        </div>
        <div class="card transactions-table">
          <table>
            <thead>
              <tr>
                <th>Time</th>
                <th>Type</th>
                <th>Pool</th>
                <th>Amount</th>
                <th>Value (USD)</th>
                <th>Fee</th>
                <th>Status</th>
                <th>Tx Hash</th>
              </tr>
            </thead>
            <tbody id="transactionsBody">
              <tr>
                <td colspan="8" class="empty-state">
                  <div class="loading-spinner"><i class="fas fa-spinner fa-spin loading-icon"></i>
                    <p class="margin-top">Loading transactions...</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="pagination hidden" id="pagination"><button class="btn-secondary" onclick="previousPage()"
            id="prevBtn" disabled="disabled"><i class="fas fa-chevron-left"></i>
            Previous</button> <span class="page-info">Page <span id="currentPage">1</span> of <span
              id="totalPages">1</span> </span><button class="btn-secondary" onclick="nextPage()" id="nextBtn">Next <i
              class="fas fa-chevron-right"></i></button></div>
      </div>
    </div>
  </main>
  <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
  <script src="theme-toggle.js"></script>
  <script src="index.js"></script>
  <script>let currentAccount = null, allTransactions = [], filteredTransactions = [], currentPage = 1; const txsPerPage = 20; async function connectWallet() { if (window.ethereum) try { const t = await window.ethereum.request({ method: "eth_requestAccounts" }); currentAccount = t[0], document.getElementById("walletStatus").style.display = "none", document.getElementById("historyContent").style.display = "block", await loadTransactionHistory() } catch (t) { console.error("Error connecting wallet:", t), alert("Failed to connect wallet") } else alert("Please install MetaMask to use this feature.") } async function loadTransactionHistory() { try { const t = new ethers.providers.Web3Provider(window.ethereum); await loadFromContractEvents(t) } catch (t) { console.error("Error loading transactions:", t), showErrorMessage("Failed to load transaction history") } } async function loadFromContractEvents(t) { try { const e = new ethers.Contract(tokenAddress, tokenABI, t), a = new ethers.Contract(stakingAddress, stakingABI, t), n = await t.getBlockNumber(), s = n - 13e5; allTransactions = []; const o = a.filters.Staked(currentAccount), r = await a.queryFilter(o, s, n); for (const t of r) { const e = await t.getBlock(), a = await t.getTransaction(), n = await t.getTransactionReceipt(); allTransactions.push({ time: new Date(1e3 * e.timestamp), type: "stake", pool: t.args.poolId.toString(), amount: parseFloat(ethers.utils.formatEther(t.args.amount)), value: 0, fee: parseFloat(ethers.utils.formatEther(n.gasUsed.mul(a.gasPrice))), hash: t.transactionHash, status: "confirmed" }) } const i = a.filters.Unstaked(currentAccount), l = await a.queryFilter(i, s, n); for (const t of l) { const e = await t.getBlock(), a = await t.getTransaction(), n = await t.getTransactionReceipt(); allTransactions.push({ time: new Date(1e3 * e.timestamp), type: "unstake", pool: t.args.poolId.toString(), amount: parseFloat(ethers.utils.formatEther(t.args.amount)), value: 0, fee: parseFloat(ethers.utils.formatEther(n.gasUsed.mul(a.gasPrice))), hash: t.transactionHash, status: "confirmed" }) } const c = a.filters.RewardClaimed(currentAccount), d = await a.queryFilter(c, s, n); for (const t of d) { const e = await t.getBlock(), a = await t.getTransaction(), n = await t.getTransactionReceipt(); allTransactions.push({ time: new Date(1e3 * e.timestamp), type: "claim", pool: t.args.poolId.toString(), amount: parseFloat(ethers.utils.formatEther(t.args.reward)), value: 0, fee: parseFloat(ethers.utils.formatEther(n.gasUsed.mul(a.gasPrice))), hash: t.transactionHash, status: "confirmed" }) } const u = e.filters.Transfer(currentAccount), m = e.filters.Transfer(null, currentAccount), [g, p] = await Promise.all([e.queryFilter(u, s, n), e.queryFilter(m, s, n)]); for (const t of [...g, ...p]) { if (t.args.from === stakingAddress || t.args.to === stakingAddress) continue; const e = await t.getBlock(), a = await t.getTransaction(), n = await t.getTransactionReceipt(); allTransactions.push({ time: new Date(1e3 * e.timestamp), type: t.args.from === currentAccount ? "transfer-out" : "transfer-in", pool: "-", amount: parseFloat(ethers.utils.formatEther(t.args.value)), value: 0, fee: parseFloat(ethers.utils.formatEther(n.gasUsed.mul(a.gasPrice))), hash: t.transactionHash, status: "confirmed" }) } allTransactions.sort((t, e) => e.time - t.time), updateStats(), applyFilters() } catch (t) { console.error("Error fetching events:", t), document.getElementById("transactionsBody").innerHTML = '\n                    <tr>\n                        <td colspan="8" style="text-align: center; padding: 60px 20px; color: var(--text-muted);">\n                            <i class="fas fa-inbox" style="font-size: 48px; opacity: 0.5; display: block; margin-bottom: 16px;"></i>\n                            <p>No transactions found or error loading history</p>\n                            <p style="font-size: 14px; margin-top: 8px;">Make sure you\'re connected to Polygon network</p>\n                        </td>\n                    </tr>\n                ' } } function updateStats() { const t = allTransactions.filter(t => "stake" === t.type), e = allTransactions.filter(t => "unstake" === t.type), a = allTransactions.filter(t => "claim" === t.type); document.getElementById("totalTxs").textContent = allTransactions.length; const n = t.reduce((t, e) => t + e.amount, 0) - e.reduce((t, e) => t + e.amount, 0); document.getElementById("totalStaked").textContent = `${n.toLocaleString(void 0, { maximumFractionDigits: 2 })} AETH`; const s = a.reduce((t, e) => t + e.amount, 0); document.getElementById("totalRewards").textContent = `${s.toLocaleString(void 0, { maximumFractionDigits: 4 })} AETH`; const o = allTransactions.reduce((t, e) => t + e.fee, 0); document.getElementById("totalFees").textContent = `${o.toFixed(4)} MATIC` } function applyFilters() { const t = document.getElementById("filterType").value, e = document.getElementById("filterTime").value; filteredTransactions = allTransactions.filter(a => { if ("all" !== t && a.type !== t) return !1; if ("all" !== e) { if (Date.now() - a.time.getTime() > { "24h": 864e5, "7d": 6048e5, "30d": 2592e6, "90d": 7776e6 }[e]) return !1 } return !0 }), currentPage = 1, displayTransactions() } function displayTransactions() { const t = 20 * (currentPage - 1), e = t + 20, a = filteredTransactions.slice(t, e), n = document.getElementById("transactionsBody"); if (0 === a.length) n.innerHTML = '\n                    <tr>\n                        <td colspan="8" style="text-align: center; padding: 60px 20px; color: var(--text-muted);">\n                            <i class="fas fa-filter" style="font-size: 48px; opacity: 0.5; display: block; margin-bottom: 16px;"></i>\n                            <p>No transactions match your filters</p>\n                        </td>\n                    </tr>\n                ', document.getElementById("pagination").style.display = "none"; else { n.innerHTML = a.map(t => `\n                        <tr>\n                            <td>${t.time.toLocaleString()}</td>\n                            <td>${{ stake: '<i class="fas fa-lock" style="color: var(--accent-blue);"></i>', unstake: '<i class="fas fa-unlock" style="color: var(--accent-orange);"></i>', claim: '<i class="fas fa-gift" style="color: var(--accent-green);"></i>', "transfer-out": '<i class="fas fa-arrow-up" style="color: var(--accent-red);"></i>', "transfer-in": '<i class="fas fa-arrow-down" style="color: var(--accent-green);"></i>', approval: '<i class="fas fa-check" style="color: var(--text-muted);"></i>' }[t.type]} ${{ stake: "Stake", unstake: "Unstake", claim: "Claim Rewards", "transfer-out": "Transfer Out", "transfer-in": "Transfer In", approval: "Approval" }[t.type]}</td>\n                            <td>${"-" === t.pool ? "-" : `Pool ${parseInt(t.pool) + 1}`}</td>\n                            <td><strong>${t.amount.toLocaleString(void 0, { maximumFractionDigits: 4 })} AETH</strong></td>\n                            <td>$${t.value.toFixed(2)}</td>\n                            <td>${t.fee.toFixed(4)} MATIC</td>\n                            <td><span class="badge badge-success">âœ“ ${t.status}</span></td>\n                            <td>\n                                <a href="https://polygonscan.com/tx/${t.hash}" target="_blank" class="tx-link">\n                                    ${t.hash.substring(0, 6)}...${t.hash.substring(t.hash.length - 4)}\n                                    <i class="fas fa-external-link-alt" style="font-size: 10px; margin-left: 4px;"></i>\n                                </a>\n                            </td>\n                        </tr>\n                    `).join(""); const t = Math.ceil(filteredTransactions.length / 20); document.getElementById("currentPage").textContent = currentPage, document.getElementById("totalPages").textContent = t, document.getElementById("prevBtn").disabled = 1 === currentPage, document.getElementById("nextBtn").disabled = currentPage === t, document.getElementById("pagination").style.display = "flex" } } function previousPage() { currentPage > 1 && (currentPage--, displayTransactions()) } function nextPage() { const t = Math.ceil(filteredTransactions.length / 20); currentPage < t && (currentPage++, displayTransactions()) } function refreshHistory() { loadTransactionHistory() } function exportHistory() { let t = "Time,Type,Pool,Amount (AETH),Value (USD),Fee (MATIC),Status,Transaction Hash\n"; filteredTransactions.forEach(e => { t += `"${e.time.toISOString()}","${e.type}","${e.pool}",${e.amount},${e.value},${e.fee},"${e.status}","${e.hash}"\n` }); const e = new Blob([t], { type: "text/csv" }), a = window.URL.createObjectURL(e), n = document.createElement("a"); n.href = a, n.download = `aetheron-transactions-${(new Date).toISOString().split("T")[0]}.csv`, n.click() } function showErrorMessage(t) { document.getElementById("transactionsBody").innerHTML = `\n                <tr>\n                    <td colspan="8" style="text-align: center; padding: 60px 20px; color: var(--accent-red);">\n                        <i class="fas fa-exclamation-circle" style="font-size: 48px; opacity: 0.5; display: block; margin-bottom: 16px;"></i>\n                        <p>${t}</p>\n                    </td>\n                </tr>\n            ` } window.addEventListener("load", async () => { if (window.ethereum) { const t = await window.ethereum.request({ method: "eth_accounts" }); t.length > 0 && (currentAccount = t[0], document.getElementById("walletStatus").style.display = "none", document.getElementById("historyContent").style.display = "block", await loadTransactionHistory()) } })</script>
  <style>
    .hidden {
      display: none;
    }

    .stat-icon-blue {
      background: var(--accent-blue);
    }

    .stat-icon-green {
      background: var(--accent-green);
    }

    .stat-icon-orange {
      background: var(--accent-orange);
    }

    .stat-icon-red {
      background: var(--accent-red);
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .loading-icon {
      font-size: 48px;
      opacity: 0.3;
    }

    .margin-top {
      margin-top: 16px;
    }

    .history-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 24px
    }

    .stat-box {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 20px
    }

    .stat-icon {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 24px
    }

    .stat-info {
      flex: 1
    }

    .stat-label {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 4px
    }

    .stat-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary)
    }

    .filters-bar {
      display: flex;
      gap: 20px;
      padding: 20px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      align-items: center
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 8px
    }

    .filter-group label {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary)
    }

    .filter-group select {
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      background: var(--input-bg);
      color: var(--text-primary);
      font-size: 14px
    }

    .transactions-table {
      overflow-x: auto
    }

    .transactions-table table {
      width: 100%;
      min-width: 1000px;
      border-collapse: collapse
    }

    .transactions-table th {
      background: var(--bg-hover);
      padding: 12px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid var(--border-color);
      font-size: 14px
    }

    .transactions-table td {
      padding: 16px 12px;
      border-bottom: 1px solid var(--border-color);
      font-size: 14px
    }

    .tx-link {
      color: var(--accent-blue);
      text-decoration: none
    }

    .tx-link:hover {
      text-decoration: underline
    }

    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-top: 24px
    }

    .page-info {
      font-size: 14px;
      color: var(--text-secondary)
    }

    @media (max-width:768px) {
      .filters-bar {
        flex-direction: column;
        align-items: stretch
      }

      .filter-group {
        flex-direction: column;
        align-items: stretch
      }

      .filter-group button,
      .filter-group select {
        width: 100%
      }

      .history-stats {
        grid-template-columns: 1fr
      }
    }
  </style>
  <script src="global-announcements.js"></script>
</body>

</html>