<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aetheron Dashboard - Live Data Test</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin-left: 10px;
        }

        .status-success {
            background: #10b981;
        }

        .status-error {
            background: #ef4444;
        }

        .status-loading {
            background: #f59e0b;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .card h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #fff;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }

        .stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .stat:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 600;
            color: #10b981;
        }

        .log-container {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .log-success { color: #10b981; }
        .log-error { color: #ef4444; }
        .log-info { color: #60a5fa; }
        .log-warn { color: #f59e0b; }

        .refresh-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 20px 0;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .timestamp {
            text-align: center;
            opacity: 0.7;
            font-size: 14px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            üöÄ Aetheron Dashboard - Live Data Test
            <span id="overallStatus" class="status-badge status-loading">Initializing...</span>
        </h1>

        <div style="text-align: center; margin-bottom: 20px;">
            <button onclick="refreshAllData()" class="refresh-btn">üîÑ Refresh All Data</button>
        </div>

        <div class="grid">
            <!-- Contract Configuration -->
            <div class="card">
                <h2>‚öôÔ∏è Contract Configuration</h2>
                <div class="stat">
                    <span class="stat-label">AETH Token:</span>
                    <span class="stat-value" id="aethAddress">-</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Staking Contract:</span>
                    <span class="stat-value" id="stakingAddress">-</span>
                </div>
                <div class="stat">
                    <span class="stat-label">RPC Endpoint:</span>
                    <span class="stat-value" id="rpcEndpoint">-</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Connection:</span>
                    <span class="stat-value" id="connectionStatus">-</span>
                </div>
            </div>

            <!-- Token Stats -->
            <div class="card">
                <h2>üí∞ Token Statistics</h2>
                <div class="stat">
                    <span class="stat-label">Total Supply:</span>
                    <span class="stat-value" id="totalSupply">Loading...</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Trading Enabled:</span>
                    <span class="stat-value" id="tradingEnabled">Loading...</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Name:</span>
                    <span class="stat-value" id="tokenName">Loading...</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Symbol:</span>
                    <span class="stat-value" id="tokenSymbol">Loading...</span>
                </div>
            </div>

            <!-- Staking Stats -->
            <div class="card">
                <h2>üìä Staking Statistics</h2>
                <div class="stat">
                    <span class="stat-label">Total Staked:</span>
                    <span class="stat-value" id="totalStaked">Loading...</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Reward Balance:</span>
                    <span class="stat-value" id="rewardBalance">Loading...</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Active Pools:</span>
                    <span class="stat-value" id="activePoolsCount">Loading...</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Staked %:</span>
                    <span class="stat-value" id="stakedPercentage">Loading...</span>
                </div>
            </div>

            <!-- Market Data -->
            <div class="card">
                <h2>üìà Market Data (DexScreener)</h2>
                <div class="stat">
                    <span class="stat-label">Price (USD):</span>
                    <span class="stat-value" id="priceUsd">Loading...</span>
                </div>
                <div class="stat">
                    <span class="stat-label">24h Change:</span>
                    <span class="stat-value" id="priceChange">Loading...</span>
                </div>
                <div class="stat">
                    <span class="stat-label">24h Volume:</span>
                    <span class="stat-value" id="volume24h">Loading...</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Liquidity:</span>
                    <span class="stat-value" id="liquidity">Loading...</span>
                </div>
            </div>
        </div>

        <!-- Activity Log -->
        <div class="card">
            <h2>üìù Activity Log</h2>
            <div class="log-container" id="logContainer">
                <div class="log-entry log-info">System initializing...</div>
            </div>
            <div class="timestamp" id="lastUpdate">Last updated: Never</div>
        </div>
    </div>

    <script>
        // Configuration
        const AETH_ADDRESS = "0xAb5ae0D8f569d7c2B27574319b864a5bA6F9671e";
        const STAKING_ADDRESS = "0x896D9d37A67B0bBf81dde0005975DA7850FFa638";
        const POLYGON_RPC_URL = 'https://polygon-rpc.com/';

        // ABIs
        const AETH_ABI = [
            "function name() view returns (string)",
            "function symbol() view returns (string)",
            "function totalSupply() view returns (uint256)",
            "function tradingEnabled() view returns (bool)",
            "function decimals() view returns (uint8)"
        ];

        const STAKING_ABI = [
            "function totalStaked() view returns (uint256)",
            "function rewardBalance() view returns (uint256)",
            "function poolCount() view returns (uint256)"
        ];

        let provider, aethContract, stakingContract;

        // Logging
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.insertBefore(logEntry, logContainer.firstChild);
            
            // Keep only last 50 entries
            while (logContainer.children.length > 50) {
                logContainer.removeChild(logContainer.lastChild);
            }
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // Initialize
        async function init() {
            try {
                log('üöÄ Initializing Aetheron Dashboard Test...', 'info');
                
                // Display configuration
                document.getElementById('aethAddress').textContent = AETH_ADDRESS.slice(0, 10) + '...';
                document.getElementById('stakingAddress').textContent = STAKING_ADDRESS.slice(0, 10) + '...';
                document.getElementById('rpcEndpoint').textContent = POLYGON_RPC_URL;

                // Initialize provider
                log(`üì° Connecting to Polygon RPC: ${POLYGON_RPC_URL}`, 'info');
                provider = new ethers.providers.JsonRpcProvider(POLYGON_RPC_URL);
                
                // Test connection
                const network = await provider.getNetwork();
                log(`‚úÖ Connected to network: ${network.name} (Chain ID: ${network.chainId})`, 'success');
                document.getElementById('connectionStatus').textContent = '‚úÖ Connected';

                // Initialize contracts
                log('üìÑ Initializing smart contracts...', 'info');
                aethContract = new ethers.Contract(AETH_ADDRESS, AETH_ABI, provider);
                stakingContract = new ethers.Contract(STAKING_ADDRESS, STAKING_ABI, provider);
                log('‚úÖ Contracts initialized', 'success');

                // Load data
                await refreshAllData();

                document.getElementById('overallStatus').textContent = '‚úÖ All Systems Operational';
                document.getElementById('overallStatus').className = 'status-badge status-success';

            } catch (error) {
                log(`‚ùå Initialization failed: ${error.message}`, 'error');
                document.getElementById('overallStatus').textContent = '‚ùå Error';
                document.getElementById('overallStatus').className = 'status-badge status-error';
                document.getElementById('connectionStatus').textContent = '‚ùå Failed';
            }
        }

        // Refresh all data
        async function refreshAllData() {
            log('üîÑ Refreshing all data...', 'info');
            
            try {
                // Fetch token data
                await Promise.all([
                    fetchTokenData(),
                    fetchStakingData(),
                    fetchMarketData()
                ]);

                document.getElementById('lastUpdate').textContent = `Last updated: ${new Date().toLocaleString()}`;
                log('‚úÖ All data refreshed successfully', 'success');

            } catch (error) {
                log(`‚ùå Error refreshing data: ${error.message}`, 'error');
            }
        }

        // Fetch token data
        async function fetchTokenData() {
            try {
                log('üìä Fetching token data from blockchain...', 'info');
                
                const [totalSupply, name, symbol, tradingEnabled] = await Promise.all([
                    aethContract.totalSupply(),
                    aethContract.name(),
                    aethContract.symbol(),
                    aethContract.tradingEnabled()
                ]);

                const supply = ethers.utils.formatEther(totalSupply);
                document.getElementById('totalSupply').textContent = `${parseFloat(supply).toLocaleString()} AETH`;
                document.getElementById('tokenName').textContent = name;
                document.getElementById('tokenSymbol').textContent = symbol;
                document.getElementById('tradingEnabled').textContent = tradingEnabled ? '‚úÖ Yes' : '‚ùå No';

                log(`‚úÖ Token data loaded: ${supply} total supply`, 'success');

            } catch (error) {
                log(`‚ùå Error fetching token data: ${error.message}`, 'error');
                throw error;
            }
        }

        // Fetch staking data
        async function fetchStakingData() {
            try {
                log('üìä Fetching staking data from blockchain...', 'info');
                
                const [totalStaked, rewardBalance, poolCount] = await Promise.all([
                    stakingContract.totalStaked(),
                    stakingContract.rewardBalance(),
                    stakingContract.poolCount()
                ]);

                const staked = parseFloat(ethers.utils.formatEther(totalStaked));
                const rewards = parseFloat(ethers.utils.formatEther(rewardBalance));

                document.getElementById('totalStaked').textContent = `${staked.toLocaleString()} AETH`;
                document.getElementById('rewardBalance').textContent = `${rewards.toLocaleString()} AETH`;
                document.getElementById('activePoolsCount').textContent = poolCount.toString();

                // Calculate staked percentage
                const totalSupply = await aethContract.totalSupply();
                const supply = parseFloat(ethers.utils.formatEther(totalSupply));
                const stakedPct = ((staked / supply) * 100).toFixed(2);
                document.getElementById('stakedPercentage').textContent = `${stakedPct}%`;

                log(`‚úÖ Staking data loaded: ${staked.toFixed(0)} AETH staked (${stakedPct}%)`, 'success');

            } catch (error) {
                log(`‚ùå Error fetching staking data: ${error.message}`, 'error');
                throw error;
            }
        }

        // Fetch market data
        async function fetchMarketData() {
            try {
                log('üìà Fetching market data from DexScreener...', 'info');
                
                const response = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${AETH_ADDRESS}`);
                const data = await response.json();

                if (data.pairs && data.pairs.length > 0) {
                    const pair = data.pairs[0];
                    const price = parseFloat(pair.priceUsd);
                    const priceChange = parseFloat(pair.priceChange.h24);
                    const volume = parseFloat(pair.volume.h24);
                    const liquidity = parseFloat(pair.liquidity?.usd || 0);

                    document.getElementById('priceUsd').textContent = `$${price.toFixed(8)}`;
                    document.getElementById('priceChange').textContent = `${priceChange >= 0 ? '+' : ''}${priceChange.toFixed(2)}%`;
                    document.getElementById('volume24h').textContent = `$${(volume / 1000).toFixed(2)}K`;
                    document.getElementById('liquidity').textContent = `$${(liquidity / 1000).toFixed(2)}K`;

                    log(`‚úÖ Market data loaded: $${price.toFixed(8)} USD`, 'success');
                } else {
                    log('‚ö†Ô∏è No market data available yet', 'warn');
                }

            } catch (error) {
                log(`‚ùå Error fetching market data: ${error.message}`, 'error');
                // Don't throw - market data is optional
            }
        }

        // Auto-refresh every 30 seconds
        setInterval(refreshAllData, 30000);

        // Initialize on load
        window.addEventListener('load', init);
    </script>
</body>
</html>
