<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://unpkg.com https://cdnjs.cloudflare.com https://www.googletagmanager.com https://www.google-analytics.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; connect-src 'self' https://api.coingecko.com https://api.coinmarketcap.com https://polygon-rpc.com https://rpc-mainnet.matic.network https://etherscan.io https://api.etherscan.io https://api.polygonscan.com https://polygonscan.com https://api.dexscreener.com https://dexscreener.com https://api.github.com https://github.com https://api.telegram.org https://telegram.org https://discord.com https://discordapp.com https://api.discord.com https://cdn.discordapp.com; frame-src 'self' https://www.youtube.com https://youtube.com https://player.vimeo.com https://vimeo.com;">
  <title>Aetheron Platform</title>
  <style>
    /* Universal Reset and Touch Improvements */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      touch-action: manipulation;
      -webkit-tap-highlight-color: rgba(0, 212, 255, 0.3);
    }

    button,
    a,
    input,
    select,
    textarea {
      touch-action: manipulation;
      -webkit-tap-highlight-color: rgba(0, 212, 255, 0.3);
    }

    /* Theme Variables */
    :root {
      --primary: #00D4FF;
      --secondary: #8A2BE2;
      --accent: #FF6B35;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --dark: #0a0a0a;
      --light: #1a1a2e;
      --text: #ffffff;
      --card-bg: rgba(26, 26, 46, 0.8);
      --bg-gradient-start: #0a0a0a;
      --bg-gradient-mid: #1a1a2e;
      --bg-gradient-end: #16213e;
    }

    [data-theme="light"] {
      --primary: #0099cc;
      --secondary: #6b21a8;
      --accent: #ea580c;
      --success: #059669;
      --danger: #dc2626;
      --warning: #d97706;
      --dark: #f8fafc;
      --light: #e2e8f0;
      --text: #1e293b;
      --card-bg: rgba(255, 255, 255, 0.9);
      --bg-gradient-start: #f1f5f9;
      --bg-gradient-mid: #e2e8f0;
      --bg-gradient-end: #cbd5e1;
    }

    /* Modern Background and Starfield */
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background:
        url('data:image/svg+xml;utf8,<svg width="100%25" height="100%25" xmlns="http://www.w3.org/2000/svg"><rect fill="%230a0a0a" width="100%25" height="100%25"/><circle cx="20" cy="30" r="2" fill="%23eee"/><circle cx="40" cy="70" r="2" fill="%23fff"/><circle cx="90" cy="40" r="1" fill="%23eee"/><circle cx="130" cy="80" r="1" fill="%23fff"/><circle cx="160" cy="30" r="2" fill="%23ddd"/><circle cx="80%25" cy="60%25" r="1.5" fill="%23fff"/><circle cx="60%25" cy="80%25" r="1.5" fill="%23b2ebf2"/><circle cx="90%25" cy="20%25" r="1.5" fill="%23fff"/></svg>') repeat,
        linear-gradient(270deg, #0f2027, #2c5364, #1a2980, #26d0ce, #1e3c72, #2a5298);
      background-size: 400% 400%, auto;
      animation: gradientBG 20s ease-in-out infinite;
      color: var(--text);
      min-height: 100vh;
      transition: background 0.3s, color 0.3s;
      overflow-x: hidden;
      position: relative;
    }
    @keyframes gradientBG {
      0% { background-position: 0% 50%, 0 0; }
      50% { background-position: 100% 50%, 0 0; }
      100% { background-position: 0% 50%, 0 0; }
    }
    #starfield-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 0;
      opacity: 0.7;
    }

    body::before,
    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: -2;
    }

    body::before {
      background-image:
        radial-gradient(2px 2px at 20px 30px, #eee, transparent),
        radial-gradient(2px 2px at 40px 70px, #fff, transparent),
        radial-gradient(1px 1px at 90px 40px, #eee, transparent),
        radial-gradient(1px 1px at 130px 80px, #fff, transparent),
        radial-gradient(2px 2px at 160px 30px, #ddd, transparent),
        radial-gradient(1.5px 1.5px at 80vw 60vh, #fff, transparent),
        radial-gradient(1.5px 1.5px at 60vw 80vh, #b2ebf2, transparent),
        radial-gradient(1.5px 1.5px at 90vw 20vh, #fff, transparent);
      background-repeat: repeat;
      background-size: 200px 100px;
      animation: twinkle 4s ease-in-out infinite alternate;
      opacity: 0.7;
      z-index: -1;
    }

    body::after {
      background: linear-gradient(120deg, rgba(0, 212, 255, 0.08) 0%, rgba(138, 43, 226, 0.08) 100%);
      z-index: -1;
    }

    @keyframes twinkle {
      0% {
        filter: brightness(0.3);
      }

      100% {
        filter: brightness(0.8);
      }
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .theme-toggle-btn {
      float: right;
      margin-top: -40px;
      margin-right: 10px;
      background: var(--card-bg);
      color: var(--primary);
      border: 1px solid var(--border-main);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 1.3em;
      cursor: pointer;
      box-shadow: var(--shadow-main);
      transition: background 0.2s, color 0.2s;
    }

    .theme-toggle-btn:hover {
      background: var(--primary);
      color: #fff;
    }

    .header {
      background: rgba(26, 26, 46, .9);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 212, 255, .3);
      padding: 30px;
      border-radius: 20px;
      margin-bottom: 30px;
      box-shadow: 0 0 40px rgba(0, 212, 255, .1);
    }

    .header h1 {
      color: #00d4ff;
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .logo {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header p {
      color: #fff;
      font-size: 1.1em;
    }

    .wallet-section {
      background: rgba(26, 26, 46, .9);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 212, 255, .2);
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 0 30px rgba(0, 212, 255, .1);
      margin-bottom: 30px;
    }

    .connect-btn {
      background: linear-gradient(135deg, #667eea 0, #764ba2 100%);
      color: #fff;
      border: none;
      padding: 15px 40px;
      border-radius: 10px;
      font-size: 1.1em;
      cursor: pointer;
      transition: transform .2s;
    }

    .connect-btn:hover {
      transform: translateY(-2px);
    }

    .connected {
      background: #4caf50;
    }

    .wallet-info {
      margin-top: 20px;
      display: none;
    }

    .wallet-info.active {
      display: block;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 15px;
      background: rgba(0, 212, 255, .1);
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid rgba(0, 212, 255, .2);
    }

    .info-label {
      font-weight: 700;
      color: #00d4ff;
    }

    .info-value {
      color: #fff;
      font-family: monospace;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: rgba(26, 26, 46, 0.72);
      -webkit-backdrop-filter: blur(18px) saturate(120%);
      backdrop-filter: blur(18px) saturate(120%);
      border: 1.5px solid rgba(0, 212, 255, 0.18);
      padding: 28px;
      border-radius: 18px;
      box-shadow: 0 8px 32px 0 rgba(0, 212, 255, 0.10), 0 1.5px 8px 0 rgba(138, 43, 226, 0.08);
      transition: transform .3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow .3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card:hover {
      transform: translateY(-7px) scale(1.015);
      box-shadow: 0 16px 48px 0 rgba(0, 212, 255, 0.18), 0 3px 16px 0 rgba(138, 43, 226, 0.12);
    }

    .card h2 {
      color: #00d4ff;
      margin-bottom: 20px;
      font-size: 1.5em;
    }

    .input-group {
      margin: 15px 0;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      color: #666;
      font-weight: 500;
    }

    .input-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1em;
    }

    .action-btn {
      background: linear-gradient(135deg, #00d4ff 0%, #8a2be2 100%);
      color: #fff;
      border: none;
      padding: 14px 32px;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 15px;
      width: 100%;
      font-size: 1.08em;
      box-shadow: 0 2px 8px rgba(0, 212, 255, 0.10);
      transition: background .3s, box-shadow .3s;
    }

    .action-btn:hover {
      background: linear-gradient(135deg, #ff6b35 0%, #00d4ff 100%);
      box-shadow: 0 6px 18px rgba(255, 107, 53, 0.13);
    }

    .status-message {
      margin-top: 15px;
      padding: 12px;
      border-radius: 8px;
      display: none;
    }

    .status-message.success {
      background: rgba(16, 185, 129, .2);
      color: #10b981;
      border: 1px solid #10b981;
      display: block;
    }

    .status-message.error {
      background: rgba(239, 68, 68, .2);
      color: #ef4444;
      border: 1px solid #ef4444;
      display: block;
    }

    .pools-list {
      margin-top: 20px;
    }

    .pool-item {
      background: rgba(0, 212, 255, .1);
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      border-left: 4px solid #00d4ff;
    }

    .pool-item h3 {
      color: #00d4ff;
      margin-bottom: 10px;
    }

    .pool-details {
      display: flex;
      justify-content: space-between;
      color: #fff;
      font-size: .95em;
    }

    .font-08 {
      font-size: .8em;
    }

    .buy-btn {
      margin-left: 10px;
    }
  </style>
  <link rel="stylesheet" href="shared-mobile-polish.css?v=1.3.0">
</head>


<body>
  <canvas id="starfield-canvas"></canvas>
  <div class="container">
    <!-- Loading Spinner -->
    <div id="globalLoading" class="loading global-loading-bg">
      <div class="global-loading-center">
        <svg width="60" height="60" viewBox="0 0 50 50">
          <circle cx="25" cy="25" r="20" fill="none" stroke="#00d4ff" stroke-width="5" stroke-linecap="round"
            stroke-dasharray="31.4 31.4" transform="rotate(-90 25 25)">
            <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s"
              repeatCount="indefinite" />
          </circle>
        </svg>
        <div class="global-loading-text">Loading...</div>
      </div>
    </div>
    <div class="header">
      <h1 class="logo">üåå Aetheron Platform</h1>
      <p>Decentralized Token & Staking Platform</p>
      <button id="themeToggleBtn" class="theme-toggle-btn" aria-label="Toggle dark/light mode" type="button">üåô</button>
    </div>
    <div class="wallet-section">
      <button id="connectBtn" type="button" class="connect-btn" aria-label="Connect Wallet">Connect Wallet</button>
      <button type="button" class="connect-btn buy-btn" aria-label="Buy AETH"><i class="fas fa-shopping-cart"></i> Buy
        AETH</button>
      <button type="button" class="connect-btn buy-btn coinbase-btn" aria-label="Pay with Crypto (Coinbase)">Pay with
        Crypto (Coinbase)</button>
      <button id="refreshBalancesBtn" type="button" class="connect-btn buy-btn refresh-btn"
        aria-label="Refresh Balances">üîÑ Refresh</button>
      <div id="walletInfo" class="wallet-info">
        <div class="info-row"><span class="info-label">Wallet Type:</span> <span class="info-value"
            id="walletType">-</span></div>
        <div class="info-row"><span class="info-label">Connected Account:</span> <span class="info-value"
            id="accountAddress">-</span>
          <button id="copyAccountBtn" class="action-btn copy-account-btn" aria-label="Copy Account Address"
            type="button">üìã</button>
        </div>
        <div class="info-row"><span class="info-label">Network:</span> <span class="info-value" id="networkName">Polygon
            Mainnet</span></div>
        <div class="info-row"><span class="info-label">MATIC Balance:</span> <span class="info-value" id="ethBalance">0
            MATIC</span></div>
        <div class="info-row"><span class="info-label">AETH Balance:</span> <span class="info-value" id="aethBalance">0
            AETH</span></div>
      </div>
    </div>
    <div class="cards-grid">
      <div class="card">
        <h2>üí∞ Transfer AETH</h2>
        <div class="input-group"><label for="transferTo">Recipient Address:</label> <input type="text" id="transferTo"
            placeholder="0x..."></div>
        <div class="input-group"><label for="transferAmount">Amount (AETH):</label> <input type="number"
            id="transferAmount" placeholder="100"></div><button type="button" class="action-btn">Transfer</button>
        <div id="transferStatus" class="status-message"></div>
      </div>
      <div class="card">
        <h2>üéØ Stake AETH</h2>
        <div class="input-group"><label for="poolId">Pool ID:</label> <input type="number" id="poolId"
            placeholder="0, 1, or 2" value="0"></div>
        <div class="input-group"><label for="stakeAmount">Amount (AETH):</label> <input type="number" id="stakeAmount"
            placeholder="1000">
        </div><button type="button" class="action-btn">Stake</button>
        <div id="stakeStatus" class="status-message"></div>
        <div class="pools-list">
          <div class="pool-item">
            <h3>Pool 0: Short Term</h3>
            <div class="pool-details"><span>Lock: 30 days</span> <span>APY: 5%</span></div>
          </div>
          <div class="pool-item">
            <h3>Pool 1: Medium Term</h3>
            <div class="pool-details"><span>Lock: 90 days</span> <span>APY: 12%</span></div>
          </div>
          <div class="pool-item">
            <h3>Pool 2: Long Term</h3>
            <div class="pool-details"><span>Lock: 180 days</span> <span>APY: 25%</span></div>
          </div>
        </div>
      </div>
      <div class="card">
        <h2>üìä Contract Info</h2>
        <div class="info-row"><span class="info-label">AETH Token:</span> <span
            class="info-value font-08">0xAb5ae0D8f569d7c2B27574319b864a5bA6F9671e</span></div>
        <div class="info-row"><span class="info-label">Staking:</span> <span
            class="info-value font-08">0x896D9d37A67B0bBf81dde0005975DA7850FFa638</span></div>
        <div class="info-row"><span class="info-label">Network:</span> <span class="info-value">Polygon Mainnet</span>
        </div>
        <div class="info-row"><span class="info-label">Chain ID:</span> <span class="info-value">137</span></div>
        <div class="info-row"><span class="info-label">Explorer:</span> <span class="info-value"><a
              href="https://polygonscan.com/token/0xAb5ae0D8f569d7c2B27574319b864a5bA6F9671e" target="_blank"
              rel="noopener noreferrer">View on PolygonScan</a></span></div>
      </div>
      <div class="card payment-history-card">
        <h2 class="payment-history-title">Payment History</h2>
        <div class="payment-history-table-wrap">
          <table class="payment-history-table">
            <thead>
              <tr class="payment-history-header-row">
                <th>Date</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Receipt</th>
                <th>Gateway</th>
              </tr>
            </thead>
            <tbody id="paymentHistoryTableBody">
              <tr>
                <td colspan="5">Loading...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- Analytics/Engagement Chart Card -->
      <div class="card" id="analyticsCard">
        <h2>üìà Engagement Analytics</h2>
        <canvas id="engagementChart" class="chart-canvas"></canvas>
      </div>
      <!-- Added missing chart canvases for price, volume, TVL, and staking -->
      <div class="card">
        <h2>üíπ Price Chart</h2>
        <canvas id="priceChart" class="chart-canvas"></canvas>
      </div>
      <div class="card">
        <h2>üìà Volume Chart</h2>
        <canvas id="volumeChart" class="chart-canvas"></canvas>
      </div>
      <div class="card">
        <h2>üè¶ TVL Chart</h2>
        <canvas id="tvlChart" class="chart-canvas"></canvas>
      </div>
      <div class="card">
        <h2>üîí Staking Chart</h2>
        <canvas id="stakingChart" class="chart-canvas"></canvas>
      </div>
      <div class="card" id="treasuryCard">
        <h2>üíº Treasury & Revenue</h2>
        <div class="info-row">
          <span class="info-label">Total Treasury:</span>
          <span class="info-value" id="treasuryTotal">- AETH</span>
        </div>
        <div class="info-row">
          <span class="info-label">Staking Rewards:</span>
          <span class="info-value" id="stakingRewards">- AETH</span>
        </div>
        <div class="info-row">
          <span class="info-label">Protocol Fees:</span>
          <span class="info-value" id="protocolFees">- MATIC</span>
        </div>
        <button class="action-btn" id="refreshTreasuryBtn" type="button">Refresh Treasury</button>
      </div>
      <div class="card">
        <h2>üìä Treasury & Revenue Chart</h2>
        <canvas id="treasuryChart" class="chart-canvas"></canvas>
      </div>
      <!-- User Profile Section -->
      <div class="card" id="userProfileCard">
        <h2>üë§ User Profile</h2>
        <div class="profile-flex">
          <div id="profileAvatar" class="profile-avatar">üßë</div>
          <div>
            <div id="profileName" class="profile-name">Guest</div>
            <div id="profileEmail" class="profile-email">Not signed in</div>
          </div>
        </div>
        <button id="editProfileBtn" class="action-btn" type="button">Edit Profile</button>
      </div>
      <!-- Onboarding Tour Button -->
      <button id="onboardingBtn" class="action-btn onboarding-btn" type="button">‚ùì Tour</button>
    </div>
  </div>
  <!-- Payment Status Modal -->
  <div id="paymentStatusModal" class="payment-status-modal-bg">
    <div class="payment-status-modal">
      <div id="paymentStatusIcon" class="payment-status-icon">üí∏</div>
      <div id="paymentStatusText" class="payment-status-text">Processing payment...</div>
      <button class="payment-status-close-btn" type="button">Close</button>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <script>
    const AETH_ADDRESS = "0xAb5ae0D8f569d7c2B27574319b864a5bA6F9671e";
    const STAKING_ADDRESS = "0x896D9d37A67B0bBf81dde0005975DA7850FFa638";

    const POLYGON_CHAIN_ID = "0x89";

    const POLYGON_PARAMS = {
      chainId: "0x89",
      chainName: "Polygon Mainnet",
      nativeCurrency: {
        name: "MATIC",
        symbol: "MATIC",
        decimals: 18
      },
      rpcUrls: ["https://polygon-rpc.com/"],
      blockExplorerUrls: ["https://polygonscan.com/"]
    };

    const AETH_ABI = [
      "function balanceOf(address) view returns (uint256)",
      "function transfer(address to,uint256 amount) returns(bool)"
    ];

    const STAKING_ABI = [
      "function stake(uint256 poolId,uint256 amount)",
      "function pools(uint256) view returns(uint256,uint256,uint256,bool)"
    ];

    let provider;
    let signer;
    let account;
    let aethContract;
    let stakingContract;

    function showGlobalLoading(show) {
      const spinner = document.getElementById("globalLoading");
      if (spinner) spinner.style.display = show ? "flex" : "none";
    }

    function showToast(message, options = {}) {
      // Simple toast implementation
      alert(message);
    }

    async function switchToPolygon() {

      try {

        await ethereum.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: POLYGON_CHAIN_ID }]
        });

      } catch (err) {

        if (err.code === 4902) {

          await ethereum.request({
            method: "wallet_addEthereumChain",
            params: [POLYGON_PARAMS]
          });

        }

      }

    }

    async function connectWallet(auto = false) {

      if (!window.ethereum) {

        if (!auto) alert("Install MetaMask");

        return;
      }

      try {

        showGlobalLoading(true);

        if (!auto) {

          await ethereum.request({
            method: "eth_requestAccounts"
          });

        }

        await switchToPolygon();

        provider =
          new ethers.providers.Web3Provider(window.ethereum);

        signer =
          provider.getSigner();

        account =
          await signer.getAddress();

        localStorage.setItem("aetheron_connected", account);

        aethContract =
          new ethers.Contract(
            AETH_ADDRESS,
            AETH_ABI,
            signer
          );

        stakingContract =
          new ethers.Contract(
            STAKING_ADDRESS,
            STAKING_ABI,
            signer
          );

        document.getElementById("walletInfo")
          .classList.add("active");

        document.getElementById("accountAddress")
          .textContent =
          account.slice(0, 6) + "..." + account.slice(-4);

        updateBalances();

      } catch (err) {

        console.log(err);

      }

      showGlobalLoading(false);
    }

    async function autoReconnect() {

      const saved =
        localStorage.getItem("aetheron_connected");

      if (saved && window.ethereum) {

        connectWallet(true);

      }

    }

    async function updateBalances() {

      if (!account) return;

      const matic =
        await provider.getBalance(account);

      document.getElementById("ethBalance")
        .textContent =
        parseFloat(
          ethers.utils.formatEther(matic)
        ).toFixed(4) + " MATIC";

      const aeth =
        await aethContract.balanceOf(account);

      document.getElementById("aethBalance")
        .textContent =
        parseFloat(
          ethers.utils.formatEther(aeth)
        ).toFixed(2) + " AETH";
    }

    async function transferTokens() {

      const to =
        document.getElementById("transferTo").value;

      const amount =
        document.getElementById("transferAmount").value;

      if (!to || !amount) return;

      try {

        showGlobalLoading(true);

        const tx =
          await aethContract.transfer(
            to,
            ethers.utils.parseEther(amount)
          );

        await tx.wait();

        alert("Transfer successful");

        updateBalances();

      } catch (err) {

        console.error(err);

        alert("Transfer failed");

      }

      showGlobalLoading(false);
    }

    async function stakeTokens() {

      const poolId =
        document.getElementById("poolId").value;

      const amount =
        document.getElementById("stakeAmount").value;

      try {

        showGlobalLoading(true);

        const tx =
          await stakingContract.stake(
            poolId,
            ethers.utils.parseEther(amount)
          );

        await tx.wait();

        alert("Stake successful");

        updateBalances();

      } catch (err) {

        console.error(err);

        alert("Stake failed");

      }

      showGlobalLoading(false);
    }

    window.addEventListener("load", autoReconnect);

    document
      .getElementById("connectBtn")
      .addEventListener("click", () =>
        connectWallet(false)
      );

    // Add event listeners for other buttons
    window.addEventListener("load", () => {
      // Refresh balances
      const refreshBtn = document.getElementById("refreshBalancesBtn");
      if (refreshBtn) refreshBtn.addEventListener("click", updateBalances);

      // Transfer
      const transferBtn = document.querySelector(".card .action-btn");
      if (transferBtn && transferBtn.textContent.includes("Transfer")) transferBtn.addEventListener("click", transferTokens);

      // Stake
      const stakeBtn = document.querySelectorAll(".card .action-btn")[1];
      if (stakeBtn && stakeBtn.textContent.includes("Stake")) stakeBtn.addEventListener("click", stakeTokens);

      // Buy AETH
      const buyBtn = document.querySelector(".buy-btn");
      if (buyBtn) buyBtn.addEventListener("click", () => {
        window.open("https://quickswap.exchange/#/swap?outputCurrency=0xAb5ae0D8f569d7c2B27574319b864a5bA6F9671e", "_blank");
      });

      // Coinbase
      const coinbaseBtn = document.querySelector(".coinbase-btn");
      if (coinbaseBtn) coinbaseBtn.addEventListener("click", () => {
        // Placeholder for Coinbase payment
        alert("Coinbase payment integration coming soon!");
      });
    });
  </script>
  <script src="global-announcements.js"></script>
  <script src="coinbase-commerce-frontend.js"></script>
  <script src="payment-history.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // --- Analytics/Engagement Chart ---
    window.addEventListener('DOMContentLoaded', () => {
      const ctx = document.getElementById('engagementChart');
      if (ctx && window.Chart) {
        const chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
              label: 'Active Users',
              data: [12, 19, 14, 17, 23, 20, 25],
              fill: true,
              backgroundColor: 'rgba(0,212,255,0.12)',
              borderColor: 'rgba(0,212,255,1)',
              tension: 0.4,
              pointBackgroundColor: 'var(--accent)',
              pointRadius: 5,
              borderWidth: 3
            }]
          },
          options: {
            plugins: {
              legend: { labels: { color: getComputedStyle(document.body).getPropertyValue('--primary') || '#00d4ff' } }
            },
            scales: {
              x: { ticks: { color: getComputedStyle(document.body).getPropertyValue('--text-main') || '#fff' } },
              y: { ticks: { color: getComputedStyle(document.body).getPropertyValue('--text-main') || '#fff' } }
            },
            responsive: true,
            maintainAspectRatio: false
          }
        });
      }
    });
  </script>
  <script>window.addEventListener('DOMContentLoaded', () => { window.renderPaymentHistory && window.renderPaymentHistory(); });</script>
  <!-- Language Selector -->
  <div class="lang-select-wrap">
    <label for="langSelect">Language:</label>
    <select id="langSelect" aria-label="Select language" class="lang-select">
      <option value="en">English</option>
      <option value="es">Espa√±ol</option>
      <option value="fr">Fran√ßais</option>
      <option value="de">Deutsch</option>
    </select>
  </div>
  <!-- Localization/i18n -->
  <script>
    const translations = {
      en: {
        title: 'Aetheron Platform',
        subtitle: 'Decentralized Token & Staking Platform',
        connect: 'Connect Wallet',
        buy: 'Buy AETH',
        pay: 'Pay with Crypto (Coinbase)',
        refresh: 'Refresh Balances',
        walletType: 'Wallet Type:',
        connectedAccount: 'Connected Account:',
        network: 'Network:',
        maticBalance: 'MATIC Balance:',
        aethBalance: 'AETH Balance:',
        transfer: 'Transfer AETH',
        recipient: 'Recipient Address:',
        amount: 'Amount (AETH):',
        transferBtn: 'Transfer',
        stake: 'Stake AETH',
        poolId: 'Pool ID:',
        stakeBtn: 'Stake',
        contractInfo: 'Contract Info',
        paymentHistory: 'Payment History',
        engagement: 'Engagement Analytics',
      },
      es: {
        title: 'Plataforma Aetheron',
        subtitle: 'Plataforma Descentralizada de Token y Staking',
        connect: 'Conectar Billetera',
        buy: 'Comprar AETH',
        pay: 'Pagar con Cripto (Coinbase)',
        refresh: 'Actualizar Saldos',
        walletType: 'Tipo de Billetera:',
        connectedAccount: 'Cuenta Conectada:',
        network: 'Red:',
        maticBalance: 'Saldo MATIC:',
        aethBalance: 'Saldo AETH:',
        transfer: 'Transferir AETH',
        recipient: 'Direcci√≥n del Destinatario:',
        amount: 'Montant (AETH):',
        amount: 'Cantidad (AETH):',
        stake: 'Apostar AETH',
        poolId: 'Pool-ID:',
        stakeBtn: 'Apostar',
        contractInfo: 'Informaci√≥n del Contrato',
        paymentHistory: 'Historial de Pagos',
        engagement: 'Anal√≠tica de Participaci√≥n',
      },
      fr: {
        title: 'Plateforme Aetheron',
        subtitle: 'Plateforme D√©centralis√©e de Jeton & Staking',
        connect: 'Connecter le Portefeuille',
        buy: 'Acheter AETH',
        pay: 'Payer en Crypto (Coinbase)',
        refresh: 'Rafra√Æchir Soldes',
        walletType: 'Type de Portefeuille:',
        connectedAccount: 'Compte Connect√©:',
        network: 'R√©seau:',
        maticBalance: 'Solde MATIC:',
        aethBalance: 'Solde AETH:',
        transfer: 'Transf√©rer AETH',
        recipient: 'Adresse du Destinataire:',
        amount: 'Montant (AETH):',
        transferBtn: 'Transf√©rer',
        stake: 'Staker AETH',
        poolId: 'Pool-ID:',
        stakeBtn: 'Staker',
        contractInfo: 'Info du Contrat',
        paymentHistory: 'Historique des Paiements',
        engagement: 'Analytique d\'Engagement',
      },
      de: {
        title: 'Aetheron Plattform',
        subtitle: 'Dezentrale Token- & Staking-Plattform',
        connect: 'Wallet Verbinden',
        buy: 'AETH Kaufen',
        pay: 'Mit Krypto Bezahlen (Coinbase)',
        refresh: 'Salden Aktualisieren',
        walletType: 'Wallet-Typ:',
        connectedAccount: 'Verbundenes Konto:',
        network: 'Netzwerk:',
        maticBalance: 'MATIC Kontostand:',
        aethBalance: 'AETH Kontostand:',
        transfer: 'AETH √úbertragen',
        recipient: 'Empf√§ngeradresse:',
        amount: 'Betrag (AETH):',
        transferBtn: '√úbertragen',
        stake: 'AETH Staken',
        poolId: 'Pool-ID:',
        stakeBtn: 'Staken',
        contractInfo: 'Vertragsinfo',
        paymentHistory: 'Zahlungsverlauf',
        engagement: 'Engagement-Analyse'
      }
    };
    function setLang(lang) {
      const t = translations[lang] || translations.en;
      document.querySelector('.logo').textContent = 'üåå ' + t.title;
      document.querySelector('.header p').textContent = t.subtitle;
      document.getElementById('connectBtn').textContent = t.connect;
      document.querySelector('.buy-btn').textContent = t.buy;
      document.querySelector('.coinbase-btn').textContent = t.pay;
      document.querySelector('.refresh-btn').textContent = 'üîÑ ' + t.refresh;
      document.getElementById('walletType').previousSibling.textContent = t.walletType + ' ';
      document.getElementById('accountAddress').previousSibling.textContent = t.connectedAccount + ' ';
      document.getElementById('networkName').previousSibling.textContent = t.network + ' ';
      document.getElementById('ethBalance').previousSibling.textContent = t.maticBalance + ' ';
      document.getElementById('aethBalance').previousSibling.textContent = t.aethBalance + ' ';
      document.querySelector('.card h2').textContent = 'üí∞ ' + t.transfer;
      document.getElementById('transferTo').previousSibling.textContent = t.recipient;
      document.getElementById('transferAmount').previousSibling.textContent = t.amount;
      document.querySelector('.card .action-btn').textContent = t.transferBtn;
      document.querySelectorAll('.card h2')[1].textContent = 'üéØ ' + t.stake;
      document.getElementById('poolId').previousSibling.textContent = t.poolId;
      document.getElementById('stakeAmount').previousSibling.textContent = t.amount;
      document.querySelectorAll('.card .action-btn')[1].textContent = t.stakeBtn;
      document.querySelectorAll('.card h2')[2].textContent = 'üìä ' + t.contractInfo;
      document.querySelector('.payment-history-title').textContent = t.paymentHistory;
      document.getElementById('analyticsCard').querySelector('h2').textContent = 'üìà ' + t.engagement;
    }
    document.getElementById('langSelect').addEventListener('change', e => {
      setLang(e.target.value);
      localStorage.setItem('dashboard-lang', e.target.value);
    });
    window.addEventListener('DOMContentLoaded', () => {
      const lang = localStorage.getItem('dashboard-lang') || 'en';
      document.getElementById('langSelect').value = lang;
      setLang(lang);
    });
  </script>
  <!-- Wallet/Social Login Options -->
  <div class="wallet-social-wrap">
    <button id="walletConnectBtn" class="connect-btn walletconnect-btn" type="button">üîó WalletConnect</button>
    <button id="googleLoginBtn" class="connect-btn google-btn" type="button">G <span
        class="google-btn-text">oogle</span></button>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    // --- WalletConnect Integration ---
    let walletConnectProvider;
    document.getElementById('walletConnectBtn').addEventListener('click', async () => {
      if (!window.WalletConnectProvider) {
        showToast('WalletConnect not loaded.', { type: 'error' });
        return;
      }
      walletConnectProvider = new window.WalletConnectProvider.default({
        rpc: { 137: 'https://polygon-rpc.com/' },
        chainId: 137
      });
      await walletConnectProvider.enable();
      provider = new ethers.providers.Web3Provider(walletConnectProvider);
      signer = provider.getSigner();
      account = (await provider.listAccounts())[0];
      document.getElementById('walletType').textContent = 'WalletConnect';
      document.getElementById('accountAddress').textContent = account;
      showToast('WalletConnect connected!', { type: 'success' });
      updateBalances();
    });
    // --- Google Social Login Integration ---
    window.handleGoogleCredential = (response) => {
      // For demo: just show a toast and fake a user
      showToast('Google login successful!', { type: 'success' });
      document.getElementById('walletType').textContent = 'Google';
      document.getElementById('accountAddress').textContent = 'user@gmail.com';
    };
    window.addEventListener('DOMContentLoaded', () => {
      if (window.google && window.google.accounts && window.google.accounts.id) {
        window.google.accounts.id.initialize({
          client_id: 'YOUR_GOOGLE_CLIENT_ID',
          client_id: window.GOOGLE_CLIENT_ID,
        });
        window.google.accounts.id.renderButton(
          document.getElementById('googleLoginBtn'),
          { theme: 'outline', size: 'large' }
        );
      } else {
        document.getElementById('googleLoginBtn').addEventListener('click', () => {
          showToast('Google login (demo only)', { type: 'success' });
          document.getElementById('walletType').textContent = 'Google';
          document.getElementById('accountAddress').textContent = 'user@gmail.com';
        });
      }
    });
  </script>
  <!-- Accessibility: ARIA landmarks and improved focus -->
  <main id="mainContent" tabindex="-1" aria-label="Dashboard main content">
    <!-- Existing content for the main dashboard -->
  </main>
  <script>
    // --- Accessibility Improvements ---
    // Focus main content on page load for screen readers
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('mainContent')?.focus();
    });
    // Add ARIA labels to key buttons (already present in most cases)
    // Ensure toast container has aria-live and aria-atomic (already present)
    // Keyboard navigation: ensure all interactive elements are focusable
    // Keyboard navigation: ensure custom interactive elements are focusable
    document.querySelectorAll('[tabindex], [role="button"], [role="link"], [role="menuitem"], [role="checkbox"], [role="radio"]').forEach(el => {
      if (!el.hasAttribute('tabindex') && !el.matches('button, select, input, textarea, a[href]')) {
        el.setAttribute('tabindex', '0');
      }
      // Add skip to content link for keyboard users
      if (!document.getElementById('skipToContent')) {
        const skip = document.createElement('a');
        skip.href = '#mainContent';
        skip.id = 'skipToContent';
        skip.textContent = 'Skip to main content';
        skip.style.position = 'absolute';
        skip.style.left = '0';
        skip.style.top = '0';
        skip.style.background = '#00d4ff';
        skip.style.color = '#222';
        skip.style.padding = '8px 16px';
        skip.style.zIndex = '2000';
        skip.style.transform = 'translateY(-120%)';
        skip.style.transition = 'transform 0.2s';
        skip.addEventListener('focus', () => { skip.style.transform = 'translateY(0)'; });
        skip.addEventListener('blur', () => { skip.style.transform = 'translateY(-120%)'; });
        document.body.prepend(skip);
      }
    });
  </script>
  <!-- Onboarding Tour Disabled - CSP Compliance -->
  <script>
    // --- Onboarding Tour --- Disabled for CSP compliance
    document.getElementById('onboardingBtn').addEventListener('click', () => {
      alert('Onboarding tour temporarily disabled for security. Please explore the dashboard manually.');
    });
  </script>
  <!-- New Features Scripts -->
  <script>
    async function loadPrice() {
      try {
        const res = await fetch("https://api.dexscreener.com/latest/dex/tokens/" + AETH_ADDRESS);
        const data = await res.json();
        const price = data.pairs[0].priceUsd;
        const el = document.createElement("div");
        el.innerHTML = "AETH Price: $" + parseFloat(price).toFixed(4);
        el.style.color = "#00d4ff";
        document.querySelector(".header").appendChild(el);
      } catch { }
    }
    loadPrice();
    setInterval(loadPrice, 30000);
  </script>
  <script>
    async function loadPoolData() {
      if (!stakingContract) return;
      for (let i = 0; i < 3; i++) {
        const pool = await stakingContract.pools(i);
        console.log("Pool", i, pool);
      }
    }
    setInterval(loadPoolData, 15000);
  </script>
  <script>
    if (window.ethereum) {
      ethereum.on("accountsChanged", () => location.reload());
      ethereum.on("chainChanged", () => location.reload());
    }
  </script>
  <script>
    async function loadTreasury() {
      if (!stakingContract || !aethContract || !provider) return;
      try {
        // Example: Fetch staking totals from pools
        let totalTreasury = 0;
        let stakingRewards = 0;
        for (let i = 0; i < 3; i++) {
          const pool = await stakingContract.pools(i);
          totalTreasury += parseFloat(ethers.utils.formatEther(pool[0]));
          stakingRewards += parseFloat(ethers.utils.formatEther(pool[1]));
        }
        document.getElementById("treasuryTotal").textContent =
          totalTreasury.toFixed(2) + " AETH";
        document.getElementById("stakingRewards").textContent =
          stakingRewards.toFixed(2) + " AETH";
        // Example: Protocol fees stored in contract
        // If you track fees in MATIC:
        const fees = await provider.getBalance(AETH_ADDRESS); // Replace with actual contract method if exists
        document.getElementById("protocolFees").textContent =
          parseFloat(ethers.utils.formatEther(fees)).toFixed(4) + " MATIC";
      } catch (e) {
        console.error("Error loading treasury:", e);
      }
    }
    // Refresh button
    document.getElementById("refreshTreasuryBtn").addEventListener("click", loadTreasury);
    // Auto-load on page
    window.addEventListener("DOMContentLoaded", loadTreasury);
  </script>
  <script>
    let treasuryChartInstance;
    async function updateTreasuryChart() {
      if (!stakingContract || !aethContract || !provider) return;
      try {
        // Fetch pool info
        const labels = ["Pool 0", "Pool 1", "Pool 2"];
        const stakingData = [];
        const treasuryData = [];
        for (let i = 0; i < 3; i++) {
          const pool = await stakingContract.pools(i);
          treasuryData.push(parseFloat(ethers.utils.formatEther(pool[0])));
          stakingData.push(parseFloat(ethers.utils.formatEther(pool[1])));
        }
        // Protocol fees in MATIC (example)
        const fees = parseFloat(ethers.utils.formatEther(await provider.getBalance(AETH_ADDRESS)));
        const data = {
          labels,
          datasets: [
            {
              label: 'Treasury (AETH)',
              data: treasuryData,
              backgroundColor: 'rgba(0, 212, 255, 0.3)',
              borderColor: 'rgba(0, 212, 255, 1)',
              borderWidth: 2,
              tension: 0.4,
              type: 'bar'
            },
            {
              label: 'Staking Rewards (AETH)',
              data: stakingData,
              backgroundColor: 'rgba(138, 43, 226, 0.2)',
              borderColor: 'rgba(138, 43, 226, 1)',
              borderWidth: 2,
              tension: 0.4,
              type: 'line',
              fill: true
            },
            {
              label: 'Protocol Fees (MATIC)',
              data: [fees, fees, fees],
              borderColor: 'rgba(255, 107, 53, 1)',
              backgroundColor: 'rgba(255, 107, 53, 0.2)',
              borderWidth: 2,
              type: 'line',
              fill: true
            }
          ]
        };
        const ctx = document.getElementById('treasuryChart').getContext('2d');
        if (treasuryChartInstance) {
          treasuryChartInstance.data = data;
          treasuryChartInstance.update();
        } else {
          treasuryChartInstance = new Chart(ctx, {
            data: data,
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  labels: { color: getComputedStyle(document.body).getPropertyValue('--text') || '#fff' }
                }
              },
              scales: {
                x: {
                  ticks: { color: getComputedStyle(document.body).getPropertyValue('--text') || '#fff' }
                },
                y: {
                  ticks: { color: getComputedStyle(document.body).getPropertyValue('--text') || '#fff' }
                }
              }
            }
          });
        }
      } catch (err) {
        console.error("Error updating treasury chart:", err);
      }
    }
    // Refresh chart every 30 seconds
    setInterval(updateTreasuryChart, 30000);
    window.addEventListener('DOMContentLoaded', updateTreasuryChart);
  </script>
  <script>
    // Animated starfield background
    (function() {
      const canvas = document.getElementById('starfield-canvas');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      let stars = [];
      const STAR_COUNT = 120;
      const STAR_COLOR = ['#fff', '#b2ebf2', '#e0e0e0', '#f5f5f5'];
      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      function createStars() {
        stars = [];
        for (let i = 0; i < STAR_COUNT; i++) {
          stars.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            r: Math.random() * 1.5 + 0.5,
            d: Math.random() * 0.5 + 0.2,
            color: STAR_COLOR[Math.floor(Math.random() * STAR_COLOR.length)]
          });
        }
      }
      function animateStars() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let star of stars) {
          ctx.beginPath();
          ctx.arc(star.x, star.y, star.r, 0, 2 * Math.PI);
          ctx.fillStyle = star.color;
          ctx.shadowColor = star.color;
          ctx.shadowBlur = 8;
          ctx.fill();
          ctx.shadowBlur = 0;
          // Move star
          star.y += star.d;
          if (star.y > canvas.height) {
            star.x = Math.random() * canvas.width;
            star.y = 0;
            star.r = Math.random() * 1.5 + 0.5;
            star.d = Math.random() * 0.5 + 0.2;
            star.color = STAR_COLOR[Math.floor(Math.random() * STAR_COLOR.length)];
          }
        }
        requestAnimationFrame(animateStars);
      }
      function initStarfield() {
        resizeCanvas();
        createStars();
        animateStars();
      }
      window.addEventListener('resize', () => {
        resizeCanvas();
        createStars();
      });
      window.addEventListener('DOMContentLoaded', initStarfield);
    })();
  </script>
</body>

</html>