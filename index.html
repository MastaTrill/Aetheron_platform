<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aetheron Platform - Your DeFi Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f3f4f6;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.98);
            padding: 1rem 2rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        
        .nav-link {
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .nav-link:hover {
            color: var(--primary);
        }
        
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .hero {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            padding: 3rem;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }
        
        .hero h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }
        
        .hero p {
            font-size: 1.25rem;
            color: #6b7280;
            margin-bottom: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }
        
        .stat-card .icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .stat-card.primary .icon { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .stat-card.success .icon { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .stat-card.warning .icon { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        .stat-card.info .icon { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
        
        .stat-card .label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
        }
        
        .stat-card .change {
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        
        .change.positive { color: var(--success); }
        .change.negative { color: var(--danger); }
        
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .wallet-section {
            text-align: center;
            padding: 3rem;
        }
        
        .wallet-connected {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 12px;
            margin-bottom: 1rem;
        }
        
        .balance-display {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            border-radius: 12px;
            margin: 1rem 0;
        }
        
        .balance-display .amount {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .staking-pools {
            display: grid;
            gap: 1rem;
        }
        
        .pool-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .pool-card:hover {
            border-color: var(--primary);
            transform: translateX(4px);
        }
        
        .pool-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .pool-duration {
            font-weight: 700;
            font-size: 1.25rem;
        }
        
        .pool-apy {
            background: var(--success);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .pool-details {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .input-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .input-group input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .quick-links {
            display: grid;
            gap: 1rem;
        }
        
        .quick-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            border-radius: 12px;
            text-decoration: none;
            color: var(--dark);
            transition: all 0.3s;
        }
        
        .quick-link:hover {
            transform: translateX(4px);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }
        
        .quick-link .icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .hidden {
            display: none;
        }
        
        .calculator-input {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .calculator-result {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            margin-top: 1rem;
        }
        
        .calculator-result .big-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--success);
            margin: 0.5rem 0;
        }
        
        .tx-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .tx-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            transition: background 0.3s;
        }
        
        .tx-item:hover {
            background: rgba(102, 126, 234, 0.05);
        }
        
        .tx-item:last-child {
            border-bottom: none;
        }
        
        .tx-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .tx-type.buy { background: #d1fae5; color: #065f46; }
        .tx-type.sell { background: #fee2e2; color: #991b1b; }
        .tx-type.stake { background: #dbeafe; color: #1e40af; }
        .tx-type.unstake { background: #fef3c7; color: #92400e; }
        
        .admin-section {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
            border: 2px solid var(--danger);
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 1rem;
        }
        
        .admin-controls {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .control-row {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .control-row input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        footer {
            text-align: center;
            padding: 2rem;
            color: rgba(255,255,255,0.8);
            margin-top: 4rem;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo">
                <i class="fas fa-rocket"></i>
                Aetheron Platform
            </div>
            <div class="nav-links">
                <a href="#" class="nav-link">Dashboard</a>
                <a href="#staking" class="nav-link">Staking</a>
                <a href="#" class="nav-link">Analytics</a>
                <button id="connectBtn" class="btn btn-primary">
                    <i class="fas fa-wallet"></i> Connect Wallet
                </button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Hero Section -->
        <div class="hero">
            <h1>Welcome to Aetheron</h1>
            <p>Your Gateway to DeFi on Polygon - Stake, Earn, and Grow</p>
            <div id="networkAlert" class="alert alert-error hidden">
                ‚ö†Ô∏è Please switch to Polygon Mainnet (Chain ID: 137)
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card primary">
                <div class="icon"><i class="fas fa-coins"></i></div>
                <div class="label">AETH Price</div>
                <div class="value" id="priceValue">Loading...</div>
                <div class="change positive" id="priceChange">--</div>
            </div>
            
            <div class="stat-card success">
                <div class="icon"><i class="fas fa-chart-line"></i></div>
                <div class="label">Market Cap</div>
                <div class="value" id="marketCapValue">Loading...</div>
                <div class="change" id="marketCapChange">--</div>
            </div>
            
            <div class="stat-card warning">
                <div class="icon"><i class="fas fa-fire"></i></div>
                <div class="label">Total Staked</div>
                <div class="value" id="stakedValue">Loading...</div>
                <div class="change" id="stakedChange">150M AETH</div>
            </div>
            
            <div class="stat-card info">
                <div class="icon"><i class="fas fa-users"></i></div>
                <div class="label">Holders</div>
                <div class="value" id="holdersValue">Loading...</div>
                <div class="change positive" id="holdersChange">Growing</div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Left Column - Wallet & Staking -->
            <div>
                <!-- Wallet Section -->
                <div class="card" style="margin-bottom: 2rem;">
                    <div class="card-header">
                        <h2 class="card-title">Your Wallet</h2>
                    </div>
                    
                    <div id="walletNotConnected" class="wallet-section">
                        <i class="fas fa-wallet" style="font-size: 4rem; color: var(--primary); margin-bottom: 1rem;"></i>
                        <h3>Connect Your Wallet</h3>
                        <p style="color: #6b7280; margin: 1rem 0;">Connect your MetaMask browser extension to start using Aetheron Platform</p>
                        <div id="metamaskStatus" style="padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                            <i class="fas fa-spinner fa-spin"></i> Checking for MetaMask...
                        </div>
                        <button class="btn btn-outline" onclick="recheckMetaMask()" style="margin-top: 0.5rem;">
                            <i class="fas fa-sync-alt"></i> Refresh Detection
                        </button>
                    </div>
                    
                    <div id="walletConnected" class="hidden">
                        <div class="wallet-connected">
                            <div>
                                <div style="font-size: 0.875rem; color: #6b7280;">Connected Wallet</div>
                                <div id="walletAddress" style="font-weight: 600; font-family: monospace;"></div>
                            </div>
                            <button class="btn btn-outline" onclick="disconnectWallet()">
                                <i class="fas fa-sign-out-alt"></i> Disconnect
                            </button>
                        </div>
                        
                        <div class="balance-display">
                            <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">Your AETH Balance</div>
                            <div class="amount" id="userBalance">0.00</div>
                            <div style="color: #6b7280; margin-top: 0.5rem;" id="userBalanceUSD">$0.00 USD</div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                            <button class="btn btn-primary" onclick="window.open('https://quickswap.exchange/#/swap?outputCurrency=0xAb5ae0D8f569d7c2B27574319b864a5bA6F9671e', '_blank')">
                                <i class="fas fa-shopping-cart"></i> Buy AETH
                            </button>
                            <button class="btn btn-success" onclick="addTokenToMetaMask()">
                                <i class="fas fa-plus"></i> Add to MetaMask
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Staking Section -->
                <div class="card" id="staking">
                    <div class="card-header">
                        <h2 class="card-title">Staking Pools</h2>
                        <span style="color: #6b7280; font-size: 0.875rem;">Earn up to 25% APY</span>
                    </div>
                    
                    <div id="stakingAlert" class="alert alert-error hidden"></div>
                    <div id="stakingSuccess" class="alert alert-success hidden"></div>
                    
                    <div class="staking-pools">
                        <!-- Pool 1 - 30 Days -->
                        <div class="pool-card">
                            <div class="pool-header">
                                <div>
                                    <div class="pool-duration">30 Days</div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Short-term staking</div>
                                </div>
                                <div class="pool-apy">5% APY</div>
                            </div>
                            <div class="pool-details">
                                <div><i class="fas fa-clock"></i> Lock: 30 days</div>
                                <div><i class="fas fa-coins"></i> Min: 100 AETH</div>
                            </div>
                            <div class="input-group">
                                <input type="number" id="stakeAmount0" placeholder="Amount to stake" min="100">
                                <button class="btn btn-primary" onclick="stakeTokens(0)" id="stakeBtn0">
                                    <i class="fas fa-lock"></i> Stake
                                </button>
                            </div>
                        </div>

                        <!-- Pool 2 - 90 Days -->
                        <div class="pool-card">
                            <div class="pool-header">
                                <div>
                                    <div class="pool-duration">90 Days</div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Medium-term staking</div>
                                </div>
                                <div class="pool-apy">12% APY</div>
                            </div>
                            <div class="pool-details">
                                <div><i class="fas fa-clock"></i> Lock: 90 days</div>
                                <div><i class="fas fa-coins"></i> Min: 500 AETH</div>
                            </div>
                            <div class="input-group">
                                <input type="number" id="stakeAmount1" placeholder="Amount to stake" min="500">
                                <button class="btn btn-primary" onclick="stakeTokens(1)" id="stakeBtn1">
                                    <i class="fas fa-lock"></i> Stake
                                </button>
                            </div>
                        </div>

                        <!-- Pool 3 - 180 Days -->
                        <div class="pool-card">
                            <div class="pool-header">
                                <div>
                                    <div class="pool-duration">180 Days</div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Long-term staking</div>
                                </div>
                                <div class="pool-apy" style="background: linear-gradient(135deg, #f59e0b, #d97706);">25% APY</div>
                            </div>
                            <div class="pool-details">
                                <div><i class="fas fa-clock"></i> Lock: 180 days</div>
                                <div><i class="fas fa-coins"></i> Min: 1000 AETH</div>
                            </div>
                            <div class="input-group">
                                <input type="number" id="stakeAmount2" placeholder="Amount to stake" min="1000">
                                <button class="btn btn-primary" onclick="stakeTokens(2)" id="stakeBtn2">
                                    <i class="fas fa-lock"></i> Stake
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Quick Links & Info -->
            <div>
                <!-- Quick Links -->
                <div class="card" style="margin-bottom: 2rem;">
                    <div class="card-header">
                        <h2 class="card-title">Quick Links</h2>
                    </div>
                    
                    <div class="quick-links">
                        <a href="https://polygonscan.com/token/0xAb5ae0D8f569d7c2B27574319b864a5bA6F9671e" target="_blank" class="quick-link">
                            <div class="icon"><i class="fas fa-search"></i></div>
                            <div>
                                <div style="font-weight: 600;">View Contract</div>
                                <div style="font-size: 0.875rem; color: #6b7280;">PolygonScan</div>
                            </div>
                        </a>
                        
                        <a href="https://www.dextools.io/app/polygon/pair-explorer/0xd57c5E33ebDC1b565F99d06809debbf86142705D" target="_blank" class="quick-link">
                            <div class="icon"><i class="fas fa-chart-area"></i></div>
                            <div>
                                <div style="font-weight: 600;">Live Chart</div>
                                <div style="font-size: 0.875rem; color: #6b7280;">DexTools</div>
                            </div>
                        </a>
                        
                        <a href="https://quickswap.exchange/#/pool" target="_blank" class="quick-link">
                            <div class="icon"><i class="fas fa-water"></i></div>
                            <div>
                                <div style="font-weight: 600;">Liquidity Pool</div>
                                <div style="font-size: 0.875rem; color: #6b7280;">QuickSwap</div>
                            </div>
                        </a>
                        
                        <a href="https://quickswap.exchange/#/swap?outputCurrency=0xAb5ae0D8f569d7c2B27574319b864a5bA6F9671e" target="_blank" class="quick-link">
                            <div class="icon"><i class="fas fa-exchange-alt"></i></div>
                            <div>
                                <div style="font-weight: 600;">Trade AETH</div>
                                <div style="font-size: 0.875rem; color: #6b7280;">Buy/Sell</div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Token Info -->
                <div class="card" style="margin-bottom: 2rem;">
                    <div class="card-header">
                        <h2 class="card-title">Token Info</h2>
                    </div>
                    
                    <div style="display: grid; gap: 1rem;">
                        <div>
                            <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem;">Contract Address</div>
                            <div style="font-family: monospace; font-size: 0.75rem; word-break: break-all; background: #f3f4f6; padding: 0.5rem; border-radius: 6px;">
                                0xAb5ae0D8f569d7c2B27574319b864a5bA6F9671e
                            </div>
                        </div>
                        
                        <div>
                            <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem;">Total Supply</div>
                            <div style="font-weight: 600;">1,000,000,000 AETH</div>
                        </div>
                        
                        <div>
                            <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem;">Network</div>
                            <div style="font-weight: 600;">Polygon Mainnet</div>
                        </div>
                        
                        <div>
                            <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem;">Decimals</div>
                            <div style="font-weight: 600;">18</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">Tax Structure</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">
                                ‚Ä¢ Buy: 3% ‚Üí Treasury<br>
                                ‚Ä¢ Sell: 5% ‚Üí Treasury<br>
                                ‚Ä¢ Tax-free for staking
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rewards Calculator -->
                <div class="card" style="margin-bottom: 2rem;">
                    <div class="card-header">
                        <h2 class="card-title">Rewards Calculator</h2>
                    </div>
                    
                    <div>
                        <label style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; display: block;">Amount to Stake</label>
                        <div class="calculator-input">
                            <input type="number" id="calcAmount" placeholder="Enter AETH amount" style="padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;">
                            <select id="calcPool" style="padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; background: white;">
                                <option value="0">30 Days (5% APY)</option>
                                <option value="1">90 Days (12% APY)</option>
                                <option value="2">180 Days (25% APY)</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-primary" onclick="calculateRewards()" style="width: 100%;">
                            <i class="fas fa-calculator"></i> Calculate Rewards
                        </button>
                        
                        <div id="calcResult" class="hidden">
                            <div class="calculator-result">
                                <div style="font-size: 0.875rem; color: #6b7280;">Estimated Rewards</div>
                                <div class="big-number" id="rewardAmount">0 AETH</div>
                                <div style="font-size: 0.875rem; color: #6b7280;">
                                    Total Return: <span id="totalReturn" style="font-weight: 600;">0 AETH</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transaction History -->
        <div class="card" style="margin-bottom: 2rem;">
            <div class="card-header">
                <h2 class="card-title">Recent Transactions</h2>
                <button class="btn btn-outline" onclick="refreshTransactions()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            
            <div id="txNotConnected" class="wallet-section">
                <i class="fas fa-receipt" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                <p style="color: #6b7280;">Connect your wallet to view transaction history</p>
            </div>
            
            <div id="txConnected" class="hidden">
                <div id="txLoading" class="wallet-section hidden">
                    <div class="loading" style="width: 40px; height: 40px;"></div>
                    <p style="margin-top: 1rem; color: #6b7280;">Loading transactions...</p>
                </div>
                
                <div id="txEmpty" class="wallet-section hidden">
                    <i class="fas fa-inbox" style="font-size: 3rem; color: #9ca3af; margin-bottom: 1rem;"></i>
                    <p style="color: #6b7280;">No transactions yet</p>
                </div>
                
                <div id="txList" class="tx-list"></div>
            </div>
        </div>

        <!-- Admin Controls (Only visible to contract owner) -->
        <div id="adminPanel" class="card hidden" style="margin-bottom: 2rem;">
            <div class="card-header">
                <h2 class="card-title" style="color: var(--danger);">
                    <i class="fas fa-shield-alt"></i> Admin Controls
                </h2>
            </div>
            
            <div class="admin-section">
                <div style="font-weight: 600; margin-bottom: 1rem;">‚ö†Ô∏è Owner Functions - Use with Caution</div>
                
                <div class="admin-controls">
                    <div>
                        <label style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; display: block;">Update Tax Rates</label>
                        <div class="control-row">
                            <input type="number" id="buyTax" placeholder="Buy Tax %" min="0" max="10">
                            <input type="number" id="sellTax" placeholder="Sell Tax %" min="0" max="10">
                            <button class="btn btn-warning" onclick="updateTaxes()">
                                <i class="fas fa-percent"></i> Update
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; display: block;">Pause/Unpause Trading</label>
                        <div class="control-row">
                            <button class="btn btn-danger" onclick="pauseTrading()" style="flex: 1;">
                                <i class="fas fa-pause"></i> Pause Trading
                            </button>
                            <button class="btn btn-success" onclick="unpauseTrading()" style="flex: 1;">
                                <i class="fas fa-play"></i> Resume Trading
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; display: block;">Withdraw Treasury</label>
                        <div class="control-row">
                            <input type="text" id="withdrawAddress" placeholder="Recipient Address">
                            <input type="number" id="withdrawAmount" placeholder="Amount">
                            <button class="btn btn-danger" onclick="withdrawTreasury()">
                                <i class="fas fa-wallet"></i> Withdraw
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; display: block;">Emergency Functions</label>
                        <div class="control-row">
                            <button class="btn btn-danger" onclick="emergencyWithdraw()" style="flex: 1;">
                                <i class="fas fa-exclamation-triangle"></i> Emergency Withdraw
                            </button>
                            <button class="btn btn-warning" onclick="rescueTokens()" style="flex: 1;">
                                <i class="fas fa-life-ring"></i> Rescue Tokens
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>¬© 2025 Aetheron Platform. Built on Polygon. Powered by DeFi.</p>
        <p style="margin-top: 0.5rem; font-size: 0.875rem;">
            <a href="#" style="color: rgba(255,255,255,0.8); margin: 0 1rem;">Terms</a>
            <a href="#" style="color: rgba(255,255,255,0.8); margin: 0 1rem;">Privacy</a>
            <a href="https://github.com/MastaTrill/Aetheron_platform" target="_blank" style="color: rgba(255,255,255,0.8); margin: 0 1rem;">GitHub</a>
        </p>
    </footer>

    <script>
        // Contract Addresses
        const AETH_ADDRESS = "0xAb5ae0D8f569d7c2B27574319b864a5bA6F9671e";
        const STAKING_ADDRESS = "0x896D9d37A67B0bBf81dde0005975DA7850FFa638";
        const OWNER_ADDRESS = "0x8A3ad49656Bd07981C9CFc7aD826a808847c3452".toLowerCase();
        const POLYGON_CHAIN_ID = '0x89'; // 137 in hex
        
        // ABIs
        const AETH_ABI = [
            "function balanceOf(address) view returns (uint256)",
            "function transfer(address to, uint256 amount) returns (bool)",
            "function approve(address spender, uint256 amount) returns (bool)",
            "function decimals() view returns (uint8)",
            "function totalSupply() view returns (uint256)",
            "function owner() view returns (address)",
            "event Transfer(address indexed from, address indexed to, uint256 value)",
            "event Approval(address indexed owner, address indexed spender, uint256 value)"
        ];
        
        const STAKING_ABI = [
            "function stake(uint256 poolId, uint256 amount)",
            "function pools(uint256) view returns (uint256 lockDuration, uint256 rewardRate, uint256 totalStaked, bool isActive)",
            "event Staked(address indexed user, uint256 poolId, uint256 amount)",
            "event Unstaked(address indexed user, uint256 poolId, uint256 amount)"
        ];
        
        let provider, signer, account;
        let aethContract, stakingContract;
        let transactions = [];
        
        let detectionAttempts = 0;
        const maxAttempts = 5;
        
        // Initialize
        window.addEventListener('load', async () => {
            await updateStats();
            setInterval(updateStats, 30000); // Update every 30 seconds
            
            // Try detecting MetaMask multiple times
            detectMetaMaskWithRetry();
            
            // Also listen for MetaMask injection event (for some browsers)
            window.addEventListener('ethereum#initialized', handleEthereumInit, { once: true });
            
            // Fallback - check again after longer delay
            setTimeout(() => {
                if (!window.ethereum) {
                    console.log('Final check: MetaMask still not detected');
                    checkMetaMaskStatus();
                }
            }, 5000);
        });
        
        function handleEthereumInit() {
            console.log('Ethereum initialized event fired');
            checkMetaMaskStatus();
        }
        
        async function detectMetaMaskWithRetry() {
            const delays = [500, 1000, 2000, 3000, 4000]; // Progressive delays
            
            for (let i = 0; i < delays.length; i++) {
                await new Promise(resolve => setTimeout(resolve, delays[i]));
                
                console.log(`Detection attempt ${i + 1}/${delays.length}`);
                const detected = await checkMetaMaskStatus();
                
                if (detected) {
                    console.log('MetaMask detected successfully!');
                    
                    // Check if MetaMask is already connected
                    try {
                        const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                        if (accounts.length > 0) {
                            await connectWallet();
                        }
                    } catch (error) {
                        console.log('Could not check existing accounts:', error);
                    }
                    break;
                }
            }
        }
        
        async function checkMetaMaskStatus() {
            const statusDiv = document.getElementById('metamaskStatus');
            
            // Debug logging
            console.log('Checking MetaMask status...');
            console.log('window.ethereum exists:', !!window.ethereum);
            console.log('window.ethereum.isMetaMask:', window.ethereum?.isMetaMask);
            console.log('window.ethereum providers:', window.ethereum?.providers);
            
            // Check for MetaMask in various ways
            let isMetaMask = false;
            
            // Method 1: Direct check
            if (window.ethereum?.isMetaMask) {
                isMetaMask = true;
            }
            
            // Method 2: Check providers array (for browsers with multiple wallets)
            if (window.ethereum?.providers) {
                const metamaskProvider = window.ethereum.providers.find(p => p.isMetaMask);
                if (metamaskProvider) {
                    isMetaMask = true;
                    console.log('Found MetaMask in providers array');
                }
            }
            
            if (isMetaMask) {
                statusDiv.innerHTML = '<i class="fas fa-check-circle" style="color: var(--success);"></i> MetaMask Detected ‚úì<br><small style="color: #6b7280;">Ready to connect</small>';
                statusDiv.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1))';
                statusDiv.style.border = '2px solid var(--success)';
                return true;
            } else if (window.ethereum) {
                statusDiv.innerHTML = '<i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i> Other wallet detected<br><small style="color: #6b7280;">MetaMask not found</small>';
                statusDiv.style.background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1))';
                statusDiv.style.border = '2px solid var(--warning)';
                return false;
            } else {
                statusDiv.innerHTML = '<i class="fas fa-times-circle" style="color: var(--danger);"></i> MetaMask Not Detected<br><small style="color: #6b7280;">Install the extension & refresh page</small>';
                statusDiv.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1))';
                statusDiv.style.border = '2px solid var(--danger)';
                return false;
            }
        }
        
        async function recheckMetaMask() {
            const statusDiv = document.getElementById('metamaskStatus');
            statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Rechecking...';
            
            // Try multiple times with delays
            let detected = false;
            for (let i = 0; i < 3; i++) {
                await new Promise(resolve => setTimeout(resolve, 500));
                detected = await checkMetaMaskStatus();
                if (detected) break;
            }
            
            if (detected) {
                alert('‚úÖ MetaMask detected!\n\nYou can now click the "Connect Wallet" button in the navbar to connect your wallet.');
            } else {
                const action = confirm(
                    '‚ùå MetaMask still not detected.\n\n' +
                    'Troubleshooting steps:\n' +
                    '1. Close and reopen your browser\n' +
                    '2. Make sure MetaMask extension is enabled\n' +
                    '3. Click the MetaMask extension icon once\n' +
                    '4. Refresh this page (F5 or Ctrl+R)\n\n' +
                    'Press OK to see debug info, or Cancel to try installing MetaMask.'
                );
                
                if (action) {
                    // Show debug info
                    alert('Debug Info:\n\n' +
                          'window.ethereum exists: ' + !!window.ethereum + '\n' +
                          'window.ethereum.isMetaMask: ' + window.ethereum?.isMetaMask + '\n' +
                          'Browser: ' + navigator.userAgent + '\n\n' +
                          'Check browser console (F12) for more details.');
                } else {
                    // Offer to install
                    window.open('https://metamask.io/download/', '_blank');
                }
            }
        }
        
        // Connect Wallet
        document.getElementById('connectBtn').addEventListener('click', connectWallet);
        
        async function connectWallet() {
            console.log('Connect wallet clicked');
            console.log('window.ethereum:', window.ethereum);
            console.log('window.ethereum.isMetaMask:', window.ethereum?.isMetaMask);
            
            // Check for MetaMask in providers array
            let ethereumProvider = window.ethereum;
            if (window.ethereum?.providers) {
                const metamaskProvider = window.ethereum.providers.find(p => p.isMetaMask);
                if (metamaskProvider) {
                    ethereumProvider = metamaskProvider;
                    console.log('Using MetaMask from providers array');
                }
            }
            
            // Check if MetaMask is installed
            const hasMetaMask = ethereumProvider?.isMetaMask || window.ethereum?.isMetaMask;
            
            if (!hasMetaMask) {
                // Update status
                await checkMetaMaskStatus();
                
                // Show alert with installation instructions
                const install = confirm(
                    'ü¶ä MetaMask Extension Not Found!\n\n' +
                    'MetaMask browser extension is not installed or not enabled.\n\n' +
                    'Click OK to open the extension store.\n' +
                    'After installing, REFRESH this page (F5) before connecting.\n\n' +
                    'Click Cancel to stay here.'
                );
                
                if (install) {
                    // Detect browser and open appropriate extension store
                    const userAgent = navigator.userAgent.toLowerCase();
                    
                    if (userAgent.includes('firefox')) {
                        window.open('https://addons.mozilla.org/en-US/firefox/addon/ether-metamask/', '_blank');
                    } else if (userAgent.includes('edg')) {
                        window.open('https://microsoftedge.microsoft.com/addons/detail/metamask/ejbalbakoplchlghecdalmeeeajnimhm', '_blank');
                    } else {
                        // Chrome, Brave, Opera, and other Chromium browsers
                        window.open('https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn', '_blank');
                    }
                    
                    alert('üìù Important:\n\n1. Install MetaMask extension\n2. Click the extension icon\n3. Set up your wallet\n4. REFRESH this page (F5 or Ctrl+R)\n5. Click "Connect Wallet" again');
                }
                return;
            }
            
            console.log('MetaMask detected, proceeding with connection...');
            
            try {
                // Use the correct provider (could be from providers array)
                let providerToUse = window.ethereum;
                if (window.ethereum?.providers) {
                    const metamaskProvider = window.ethereum.providers.find(p => p.isMetaMask);
                    if (metamaskProvider) {
                        providerToUse = metamaskProvider;
                        console.log('Using MetaMask provider from providers array');
                    }
                }
                
                // First check if MetaMask is unlocked
                console.log('Checking if MetaMask is unlocked...');
                let existingAccounts;
                try {
                    existingAccounts = await providerToUse.request({ method: 'eth_accounts' });
                    console.log('Existing accounts check:', existingAccounts);
                } catch (checkError) {
                    console.error('Error checking accounts:', checkError);
                    alert('üîí MetaMask Issue\n\nPlease:\n1. Click the MetaMask extension icon\n2. Make sure it\'s unlocked (enter password)\n3. Try connecting again\n\nError: ' + checkError.message);
                    return;
                }
                
                // Now request permission to connect
                console.log('Requesting accounts from MetaMask...');
                let accounts;
                try {
                    accounts = await providerToUse.request({ method: 'eth_requestAccounts' });
                } catch (requestError) {
                    console.error('Account request error:', requestError);
                    console.error('Error details:', JSON.stringify(requestError, null, 2));
                    throw requestError;
                }
                
                console.log('Accounts received:', accounts);
                
                if (!accounts || accounts.length === 0) {
                    throw new Error('No accounts returned from MetaMask. Please unlock your wallet and try again.');
                }
                
                // Now create ethers provider with the connected provider
                provider = new ethers.providers.Web3Provider(providerToUse, "any");
                
                // Get the signer and account
                account = accounts[0]; // Use the account directly from the request
                signer = provider.getSigner();
                
                console.log('Connected account:', account);
                
                // Check network
                const network = await provider.getNetwork();
                console.log('Current network:', network);
                
                if (network.chainId !== 137) {
                    document.getElementById('networkAlert').classList.remove('hidden');
                    try {
                        // Request network switch through MetaMask extension
                        await providerToUse.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: POLYGON_CHAIN_ID }]
                        });
                        document.getElementById('networkAlert').classList.add('hidden');
                    } catch (error) {
                        if (error.code === 4902) {
                            // Network not added, add it through MetaMask extension
                            await providerToUse.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: POLYGON_CHAIN_ID,
                                    chainName: 'Polygon Mainnet',
                                    nativeCurrency: { name: 'POL', symbol: 'POL', decimals: 18 },
                                    rpcUrls: ['https://polygon-rpc.com'],
                                    blockExplorerUrls: ['https://polygonscan.com']
                                }]
                            });
                            document.getElementById('networkAlert').classList.add('hidden');
                        } else {
                            console.error('Network switch error:', error);
                            throw error;
                        }
                    }
                } else {
                    document.getElementById('networkAlert').classList.add('hidden');
                }
                
                aethContract = new ethers.Contract(AETH_ADDRESS, AETH_ABI, signer);
                stakingContract = new ethers.Contract(STAKING_ADDRESS, STAKING_ABI, signer);
                
                // Update UI
                document.getElementById('connectBtn').innerHTML = '<i class="fas fa-check-circle"></i> Connected';
                document.getElementById('connectBtn').style.background = 'var(--success)';
                document.getElementById('walletNotConnected').classList.add('hidden');
                document.getElementById('walletConnected').classList.remove('hidden');
                
                const shortAddress = `${account.substring(0, 6)}...${account.substring(38)}`;
                document.getElementById('walletAddress').textContent = shortAddress;
                
                await updateBalance();
                await checkAdminStatus();
                await loadTransactions();
                
            } catch (error) {
                console.error('Connection error:', error);
                console.error('Error code:', error.code);
                console.error('Error message:', error.message);
                console.error('Full error:', JSON.stringify(error, null, 2));
                
                if (error.code === 4001) {
                    alert('‚ùå Connection Rejected\n\nYou rejected the connection request in MetaMask. Please click "Connect Wallet" again and approve the connection.');
                } else if (error.code === -32002) {
                    alert('‚è≥ Connection Pending\n\nPlease check your MetaMask extension - there\'s a pending connection request waiting for your approval.');
                } else if (error.code === -32603) {
                    const action = confirm(
                        '‚ö†Ô∏è MetaMask Internal Error\n\n' +
                        'This usually means MetaMask needs to be reset or unlocked.\n\n' +
                        'Quick Fixes:\n' +
                        '1. Click the MetaMask extension icon\n' +
                        '2. Make sure it\'s fully unlocked\n' +
                        '3. Try switching to a different account and back\n' +
                        '4. Lock and unlock MetaMask\n\n' +
                        'Click OK to see detailed error info for troubleshooting.'
                    );
                    if (action) {
                        alert('Detailed Error:\n\n' + 
                              'Code: ' + error.code + '\n' +
                              'Message: ' + error.message + '\n\n' +
                              'Press F12 for full console logs.');
                    }
                } else if (error.message && error.message.includes('No accounts')) {
                    alert('üîí Wallet Locked\n\nYour MetaMask wallet appears to be locked.\n\nPlease:\n1. Click the MetaMask extension icon\n2. Enter your password to unlock\n3. Try connecting again');
                } else {
                    alert('‚ùå Connection Failed\n\n' + (error.message || 'Unknown error') + '\n\nTroubleshooting:\n‚Ä¢ Make sure MetaMask is unlocked\n‚Ä¢ Try locking/unlocking MetaMask\n‚Ä¢ Refresh this page (F5) and try again\n‚Ä¢ Check console (F12) for details');
                }
            }
        }
        
        async function checkAdminStatus() {
            if (!account) return;
            
            // Check if connected wallet is the owner
            if (account.toLowerCase() === OWNER_ADDRESS) {
                document.getElementById('adminPanel').classList.remove('hidden');
            }
        }
        
        async function loadTransactions() {
            if (!account) return;
            
            document.getElementById('txNotConnected').classList.add('hidden');
            document.getElementById('txConnected').classList.remove('hidden');
            document.getElementById('txLoading').classList.remove('hidden');
            
            try {
                // Get Transfer events for the user
                const filter = aethContract.filters.Transfer(account);
                const events = await aethContract.queryFilter(filter, -10000); // Last ~10k blocks
                
                const filter2 = aethContract.filters.Transfer(null, account);
                const events2 = await aethContract.queryFilter(filter2, -10000);
                
                const allEvents = [...events, ...events2];
                
                if (allEvents.length === 0) {
                    document.getElementById('txLoading').classList.add('hidden');
                    document.getElementById('txEmpty').classList.remove('hidden');
                    return;
                }
                
                // Process and display transactions
                const txList = document.getElementById('txList');
                txList.innerHTML = '';
                
                const recentTxs = allEvents.slice(-20).reverse(); // Last 20 transactions
                
                for (const event of recentTxs) {
                    const block = await event.getBlock();
                    const date = new Date(block.timestamp * 1000);
                    const amount = ethers.utils.formatEther(event.args.value);
                    const isIncoming = event.args.to.toLowerCase() === account.toLowerCase();
                    
                    const txItem = document.createElement('div');
                    txItem.className = 'tx-item';
                    txItem.innerHTML = `
                        <div>
                            <span class="tx-type ${isIncoming ? 'buy' : 'sell'}">${isIncoming ? 'Received' : 'Sent'}</span>
                            <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;">
                                ${date.toLocaleDateString()} ${date.toLocaleTimeString()}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 600; ${isIncoming ? 'color: var(--success)' : 'color: var(--danger)'}">
                                ${isIncoming ? '+' : '-'}${parseFloat(amount).toLocaleString()} AETH
                            </div>
                            <a href="https://polygonscan.com/tx/${event.transactionHash}" target="_blank" style="font-size: 0.75rem; color: var(--primary);">
                                View <i class="fas fa-external-link-alt"></i>
                            </a>
                        </div>
                    `;
                    txList.appendChild(txItem);
                }
                
                document.getElementById('txLoading').classList.add('hidden');
                
            } catch (error) {
                console.error('Error loading transactions:', error);
                document.getElementById('txLoading').classList.add('hidden');
                document.getElementById('txEmpty').classList.remove('hidden');
            }
        }
        
        function refreshTransactions() {
            if (account) {
                loadTransactions();
            }
        }
        
        function calculateRewards() {
            const amount = parseFloat(document.getElementById('calcAmount').value);
            const poolId = parseInt(document.getElementById('calcPool').value);
            
            if (!amount || amount <= 0) {
                alert('Please enter a valid amount');
                return;
            }
            
            const apys = [5, 12, 25]; // APY for each pool
            const durations = [30, 90, 180]; // Days for each pool
            
            const apy = apys[poolId];
            const days = durations[poolId];
            
            // Calculate rewards: (amount * APY * days) / 365
            const rewards = (amount * apy * days) / (365 * 100);
            const totalReturn = amount + rewards;
            
            document.getElementById('rewardAmount').textContent = rewards.toLocaleString(undefined, {maximumFractionDigits: 2}) + ' AETH';
            document.getElementById('totalReturn').textContent = totalReturn.toLocaleString(undefined, {maximumFractionDigits: 2}) + ' AETH';
            document.getElementById('calcResult').classList.remove('hidden');
        }
        
        function disconnectWallet() {
            account = null;
            provider = null;
            signer = null;
            
            document.getElementById('connectBtn').innerHTML = '<i class="fas fa-wallet"></i> Connect Wallet';
            document.getElementById('connectBtn').style.background = '';
            document.getElementById('walletNotConnected').classList.remove('hidden');
            document.getElementById('walletConnected').classList.add('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('txNotConnected').classList.remove('hidden');
            document.getElementById('txConnected').classList.add('hidden');
        }
        
        async function updateBalance() {
            if (!account || !aethContract) return;
            
            try {
                const balance = await aethContract.balanceOf(account);
                const formattedBalance = parseFloat(ethers.utils.formatEther(balance)).toLocaleString(undefined, {
                    maximumFractionDigits: 2
                });
                
                document.getElementById('userBalance').textContent = formattedBalance;
                
                // Update USD value with live price
                try {
                    const pairAddress = '0xd57c5E33ebDC1b565F99d06809debbf86142705D';
                    const response = await fetch(`https://api.dexscreener.com/latest/dex/pairs/polygon/${pairAddress}`);
                    const data = await response.json();
                    
                    if (data && data.pair && data.pair.priceUsd) {
                        const price = parseFloat(data.pair.priceUsd);
                        const balanceNum = parseFloat(ethers.utils.formatEther(balance));
                        const usdValue = (balanceNum * price).toFixed(2);
                        document.getElementById('userBalanceUSD').textContent = '$' + parseFloat(usdValue).toLocaleString() + ' USD';
                    } else {
                        document.getElementById('userBalanceUSD').textContent = '$0.00 USD';
                    }
                } catch (priceError) {
                    console.log('Could not fetch price for USD conversion:', priceError);
                    document.getElementById('userBalanceUSD').textContent = '$0.00 USD';
                }
            } catch (error) {
                console.error('Balance fetch error:', error);
            }
        }
        
        async function updateStats() {
            try {
                // Fetch real-time data from DexScreener API
                const pairAddress = '0xd57c5E33ebDC1b565F99d06809debbf86142705D';
                const response = await fetch(`https://api.dexscreener.com/latest/dex/pairs/polygon/${pairAddress}`);
                const data = await response.json();
                
                if (data && data.pair) {
                    const pair = data.pair;
                    
                    // Update price
                    const price = parseFloat(pair.priceUsd);
                    document.getElementById('priceValue').textContent = '$' + price.toFixed(10);
                    
                    // Update price change
                    const priceChange = pair.priceChange?.h24;
                    if (priceChange) {
                        const changeElement = document.getElementById('priceChange');
                        changeElement.textContent = (priceChange > 0 ? '+' : '') + priceChange.toFixed(2) + '%';
                        changeElement.className = 'change ' + (priceChange > 0 ? 'positive' : 'negative');
                    }
                    
                    // Update market cap
                    if (pair.fdv) {
                        const fdv = parseFloat(pair.fdv);
                        document.getElementById('marketCapValue').textContent = '$' + (fdv >= 1000000 ? (fdv / 1000000).toFixed(2) + 'M' : (fdv >= 1000 ? (fdv / 1000).toFixed(2) + 'K' : fdv.toFixed(0)));
                    }
                    
                    // Update liquidity as "staked" proxy
                    if (pair.liquidity?.usd) {
                        const liquidity = parseFloat(pair.liquidity.usd);
                        document.getElementById('stakedValue').textContent = '$' + (liquidity >= 1000 ? (liquidity / 1000).toFixed(1) + 'K' : liquidity.toFixed(0));
                    }
                    
                    // Try to get holder count from PolygonScan
                    await updateHolders();
                    
                    console.log('‚úÖ Stats updated with live data');
                } else {
                    throw new Error('No pair data available');
                }
            } catch (error) {
                console.error('Error fetching stats:', error);
                // Fallback to static data
                document.getElementById('priceValue').textContent = '$0.0000005512';
                document.getElementById('marketCapValue').textContent = '$276';
                document.getElementById('stakedValue').textContent = '150M';
                document.getElementById('holdersValue').textContent = '10+';
            }
        }
        
        async function updateHolders() {
            try {
                // Fetch holders from PolygonScan API (requires API key for detailed data)
                // For now, fetch from blockchain directly
                const tokenAddress = AETH_ADDRESS;
                const response = await fetch(`https://api.polygonscan.com/api?module=stats&action=tokensupply&contractaddress=${tokenAddress}`);
                const data = await response.json();
                
                if (data.status === '1') {
                    // This is just supply, but we'll show it for now
                    document.getElementById('holdersValue').textContent = '10+ Holders';
                }
            } catch (error) {
                console.log('Could not fetch holder count:', error);
                document.getElementById('holdersValue').textContent = '10+';
            }
        }
        
        async function stakeTokens(poolId) {
            if (!account) {
                alert('Please connect your wallet first!');
                return;
            }
            
            const amount = document.getElementById(`stakeAmount${poolId}`).value;
            if (!amount || parseFloat(amount) <= 0) {
                showStakingError('Please enter a valid amount');
                return;
            }
            
            const button = document.getElementById(`stakeBtn${poolId}`);
            const originalHTML = button.innerHTML;
            
            try {
                button.innerHTML = '<span class="loading"></span> Processing...';
                button.disabled = true;
                
                // Approve tokens
                const amountWei = ethers.utils.parseEther(amount);
                const approveTx = await aethContract.approve(STAKING_ADDRESS, amountWei);
                await approveTx.wait();
                
                // Stake tokens
                const stakeTx = await stakingContract.stake(poolId, amountWei);
                await stakeTx.wait();
                
                showStakingSuccess(`Successfully staked ${amount} AETH!`);
                document.getElementById(`stakeAmount${poolId}`).value = '';
                await updateBalance();
                
            } catch (error) {
                console.error('Staking error:', error);
                showStakingError('Staking failed: ' + error.message);
            } finally {
                button.innerHTML = originalHTML;
                button.disabled = false;
            }
        }
        
        function showStakingError(message) {
            const alert = document.getElementById('stakingAlert');
            alert.textContent = message;
            alert.classList.remove('hidden');
            setTimeout(() => alert.classList.add('hidden'), 5000);
        }
        
        function showStakingSuccess(message) {
            const alert = document.getElementById('stakingSuccess');
            alert.textContent = message;
            alert.classList.remove('hidden');
            setTimeout(() => alert.classList.add('hidden'), 5000);
        }
        
        async function addTokenToMetaMask() {
            if (!window.ethereum || !window.ethereum.isMetaMask) {
                alert('ü¶ä MetaMask extension not found.\n\nPlease install MetaMask extension first, then try again.');
                return;
            }
            
            try {
                // Request to add token through MetaMask extension
                const wasAdded = await window.ethereum.request({
                    method: 'wallet_watchAsset',
                    params: {
                        type: 'ERC20',
                        options: {
                            address: AETH_ADDRESS,
                            symbol: 'AETH',
                            decimals: 18,
                            image: 'https://via.placeholder.com/256'
                        }
                    }
                });
                
                if (wasAdded) {
                    alert('‚úÖ AETH token added to MetaMask!\n\nYou can now see your AETH balance in the MetaMask extension.');
                }
            } catch (error) {
                console.error('Error adding token:', error);
                alert('Failed to add token to MetaMask. Please try again or add it manually in MetaMask extension.');
            }
        }
        
        // Admin Functions
        async function updateTaxes() {
            if (!account || account.toLowerCase() !== OWNER_ADDRESS) {
                alert('Only the contract owner can perform this action');
                return;
            }
            
            const buyTax = document.getElementById('buyTax').value;
            const sellTax = document.getElementById('sellTax').value;
            
            if (!buyTax || !sellTax) {
                alert('Please enter both buy and sell tax rates');
                return;
            }
            
            alert('This function requires the contract to have an updateTaxes function. Feature coming soon!');
        }
        
        async function pauseTrading() {
            if (!account || account.toLowerCase() !== OWNER_ADDRESS) {
                alert('Only the contract owner can perform this action');
                return;
            }
            
            if (confirm('Are you sure you want to PAUSE trading? This will prevent all transfers.')) {
                alert('This function requires the contract to have a pause function. Feature coming soon!');
            }
        }
        
        async function unpauseTrading() {
            if (!account || account.toLowerCase() !== OWNER_ADDRESS) {
                alert('Only the contract owner can perform this action');
                return;
            }
            
            if (confirm('Resume trading?')) {
                alert('This function requires the contract to have an unpause function. Feature coming soon!');
            }
        }
        
        async function withdrawTreasury() {
            if (!account || account.toLowerCase() !== OWNER_ADDRESS) {
                alert('Only the contract owner can perform this action');
                return;
            }
            
            const address = document.getElementById('withdrawAddress').value;
            const amount = document.getElementById('withdrawAmount').value;
            
            if (!address || !amount) {
                alert('Please enter recipient address and amount');
                return;
            }
            
            if (!ethers.utils.isAddress(address)) {
                alert('Invalid address');
                return;
            }
            
            if (confirm(`Withdraw ${amount} AETH to ${address}?`)) {
                try {
                    const amountWei = ethers.utils.parseEther(amount);
                    const tx = await aethContract.transfer(address, amountWei);
                    alert('Transaction submitted! Hash: ' + tx.hash);
                    await tx.wait();
                    alert('Withdrawal successful!');
                    await updateBalance();
                } catch (error) {
                    console.error('Withdrawal error:', error);
                    alert('Withdrawal failed: ' + error.message);
                }
            }
        }
        
        async function emergencyWithdraw() {
            if (!account || account.toLowerCase() !== OWNER_ADDRESS) {
                alert('Only the contract owner can perform this action');
                return;
            }
            
            if (confirm('‚ö†Ô∏è EMERGENCY WITHDRAW - Are you absolutely sure? This is irreversible!')) {
                alert('This function requires the contract to have an emergency withdraw function. Feature coming soon!');
            }
        }
        
        async function rescueTokens() {
            if (!account || account.toLowerCase() !== OWNER_ADDRESS) {
                alert('Only the contract owner can perform this action');
                return;
            }
            
            const tokenAddress = prompt('Enter token address to rescue:');
            if (tokenAddress && ethers.utils.isAddress(tokenAddress)) {
                alert('This function requires the contract to have a rescue tokens function. Feature coming soon!');
            }
        }
    </script>
</body>
</html>
